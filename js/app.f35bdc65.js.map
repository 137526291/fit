{"version":3,"file":"js/app.f35bdc65.js","mappings":"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","sources":["webpack://vue0/./src/App.vue","webpack://vue0/./src/components/FileRead.vue","webpack://vue0/./src/components/FileRead.vue?cb11","webpack://vue0/./src/components/TodoItem.vue","webpack://vue0/./src/components/TodoItem.vue?efb7","webpack://vue0/./src/components/TodoForm.vue","webpack://vue0/./src/components/TodoForm.vue?862e","webpack://vue0/./src/bmv1.js","webpack://vue0/./src/App.vue?7ccd","webpack://vue0/./src/main.js","webpack://vue0/webpack/bootstrap","webpack://vue0/webpack/runtime/chunk loaded","webpack://vue0/webpack/runtime/compat get default export","webpack://vue0/webpack/runtime/define property getters","webpack://vue0/webpack/runtime/global","webpack://vue0/webpack/runtime/hasOwnProperty shorthand","webpack://vue0/webpack/runtime/make namespace object","webpack://vue0/webpack/runtime/publicPath","webpack://vue0/webpack/runtime/jsonp chunk loading","webpack://vue0/webpack/startup"],"sourcesContent":["<template>\r\n  <div>\r\n    <button class=\"btn btn__lg btn-group\" @click=\"testBLE\">BLE</button>\r\n    <button class=\"btn btn__danger btn-group\" @click=\"disconnect\">disconnect</button>\r\n    <button class=\"btn\" @click=\"send\">send</button>\r\n    <button class=\"btn\" @click=\"append\">append</button>\r\n    <button class=\"btn\" @click=\"clear\">clear</button>\r\n    <button class=\"btn\" @click=\"v1ota\">v1ota</button>\r\n    <textarea v-model=\"logText\" id=\"log\" rows=\"10\" cols=\"40\"></textarea><br>\r\n    <table>\r\n      <tr v-for=\"(value, name) in variables\" :key=\"name\">\r\n        <td>{{ name }}</td>\r\n        <td>{{ value }}</td>\r\n      </tr>\r\n    </table>\r\n    <!-- Chart container -->\r\n    \r\n    <input type=\"range\" id=\"up_progress\" :value=\"upgradeProgress\"><br>\r\n    <file-read @file-loaded=\"handleFileLoaded\"></file-read>\r\n    <h1>TODO List</h1>\r\n    <todo-form @add-todo=\"addTodo\"></todo-form>\r\n    <ul aria-labelledby=\"list-summary\" class=\"stack_large\">\r\n      <li v-for=\"item in TodoItems\" :key=\"item.id\">\r\n        <!-- <todo-item label=\"my fucking todo\" :done='true'></todo-item> -->\r\n        <todo-item :label=\"item.label\" :done=\"item.done\" :id=\"item.id\"></todo-item>\r\n      </li>\r\n    </ul>\r\n    <img alt=\"Vue logo\" src=\"./assets/image.webp\" width=\"500\" height=\"500\">\r\n    <div ref=\"chart\" style=\"width: 500px;height:500px;\"></div>\r\n\r\n  </div>\r\n  <!-- <img alt=\"Vue logo\" src=\"./assets/logo.png\"> -->\r\n  <!-- <HelloWorld msg=\"Welcome to Your Vue.js App\" /> -->\r\n</template>\r\n\r\n<script>\r\nimport FileRead from './components/FileRead.vue';\r\n// import HelloWorld from './components/HelloWorld.vue';\r\nimport TodoItem from './components/TodoItem.vue';\r\nimport TodoForm from \"./components/TodoForm\";\r\nimport uniqueId from \"lodash.uniqueid\";\r\nimport { Bmv1 } from './bmv1.js'; //如果是导出函数需要加大括号\r\nimport * as echarts from 'echarts';\r\n//如需导出class 则使用constructor\r\n// let v1 = new Bmv1(this.methods.ble_read, this.methods.ble_write );\r\n// let v1 = this.v1;\r\nlet gattServer;\r\n// let commandService;\r\n// let readCharacteristic;\r\nlet writeCharacteristic;\r\nlet commandQueue = [];\r\nlet busy = false;\r\nconst FIFO_CNT = 50;\r\n\r\n// typedef enum\r\n// {\r\n//     PWR_WAIT_RMS,       // 等待ac有效值变大\r\n//     PWR_WAIT_DC_STABLE, // 初始上电 等待稳定\r\n//     PWR_WAIT_PFC,       // 等待PFC工作稳定\r\n//     PWR_STABLE,         // 电源稳定，可正常工作\r\n//     PWR_STABLE_SLEEP,   // 电源稳定，关闭PWM锁闭电机进行休眠\r\n//     PWR_DISCHARGING,    // 开始泄放掉电，主动放电\r\n//     PWR_FATAL,\r\n// } pwr_fsm_e;\r\nconst fsm2str = {\r\n  0: 'PWR_WAIT_RMS',\r\n  1: 'PWR_WAIT_DC_STABLE',\r\n  2: 'PWR_WAIT_PFC',\r\n  3: 'PWR_STABLE',\r\n  4: 'PWR_STABLE_SLEEP',\r\n  5: 'PWR_DISCHARGING',\r\n  6: 'PWR_FATAL',\r\n};\r\n// const fsmToString = {\r\n//   PWR_WAIT_RMS: '等待ac有效值变大',\r\n//   PWR_WAIT_DC_STABLE: '初始上电 等待稳定',\r\n//   PWR_WAIT_PFC: '等待PFC工作稳定',\r\n//   PWR_STABLE: '电源稳定,可正常工作',\r\n//   PWR_STABLE_SLEEP: '电源稳定,关闭PWM锁闭电机进行休眠',\r\n//   PWR_DISCHARGING: '开始泄放掉电,主动放电',\r\n//   PWR_FATAL: 'PWR_FATAL',\r\n// };\r\n\r\n\r\nexport default {\r\n  name: 'App',\r\n  components: {\r\n    TodoItem,\r\n    TodoForm,\r\n    FileRead,\r\n  },\r\n  data() {\r\n    return {\r\n      TodoItems: [\r\n        { id: uniqueId(\"todo-\"), label: \"fuck me\", done: false },\r\n        { id: uniqueId(\"todo-\"), label: \"fuck you\", done: false },\r\n        { id: uniqueId(\"todo-\"), label: \"have fun\", done: true },\r\n        { id: uniqueId(\"todo-\"), label: \"learn vue\", done: false },\r\n      ],\r\n      binFile: new Uint8Array([]),\r\n      logText: '',\r\n      v1: null,\r\n      upgradeProgress: 0,\r\n      variables: {\r\n        'vac': 0,\r\n        'vac_rms': 0,\r\n        'vdc': 0,\r\n        'ibus': 0,\r\n        'tempm0': 0,\r\n        'tempm1': 0,\r\n        'tempmos': 0,\r\n        'fsm_raw': 0,\r\n        'fsm_str': 0,\r\n      },\r\n      var_fifos: [\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n        new Array(FIFO_CNT),\r\n      ],\r\n      simu_dt : 0,\r\n      echartOption : {\r\n        legend: {\r\n          data: ['vac', 'vac_rms', 'vdc', 'ibus', 'tempm0', 'tempm1', 'tempmos',  'fsm_raw', 'fsm_str' ],\r\n          // orient: 'vertical',\r\n          // top: 20,\r\n          // // left:10,\r\n          // // top: 'center',\r\n          // left: 'center',\r\n          // backgroundColor: '#eee',\r\n          // z: 400,\r\n        },\r\n      },\r\n      chartInstance: null,\r\n      // v1 : new Bmv1(),\r\n    };\r\n  },\r\n\r\n  methods: {\r\n    initChart() {\r\n      // Initialize the chart instance\r\n      this.chartInstance = echarts.init(this.$refs.chart);\r\n\r\n      //gen fake data for variables\r\n      this.variables['vac'] = 123;\r\n      this.variables['vdc'] = 333;\r\n\r\n      // Define the chart options\r\n      const option = {\r\n        xAxis: {\r\n          type: 'category',\r\n          // data: Object.keys(this.variables)\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        },\r\n        series: [{\r\n          data: Object.values(this.variables),\r\n          type: 'line'\r\n        }]\r\n      };\r\n\r\n      // Set the chart options\r\n      this.chartInstance.setOption(option);\r\n    },\r\n\r\n    updatePlot() {\r\n      // Update the chart with new data\r\n      const option = {\r\n        series: [{\r\n          data: Object.values(this.variables)\r\n        }]\r\n      };\r\n      this.chartInstance.setOption(option);\r\n    },\r\n\r\n    updatePlotFifo() {\r\n      // Update the chart with new data\r\n      for (let i = 0; i < this.var_fifos.length; i++) {\r\n        this.var_fifos[i].shift();\r\n        this.var_fifos[i].push(this.variables[Object.keys(this.variables)[i]]);\r\n      }\r\n      // console.log(this.variables);\r\n      console.log(this.var_fifos);\r\n\r\n\r\n      this.echartOption = {\r\n        xAxis: {\r\n          type: 'category',\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        },\r\n        series: [{\r\n          name: 'vac',\r\n          data: this.var_fifos[0],\r\n        },\r\n      ]};\r\n      this.chartInstance.setOption(this.echartOption);\r\n    },\r\n    fakeSimuPlot() {\r\n      //gen sin wave into this.var_fifos\r\n      this.simu_dt += 0.1;\r\n      \r\n      for (let i = 0; i < this.var_fifos.length; i++) {\r\n        console.log(this.var_fifos[i]);\r\n        this.var_fifos[i].shift();\r\n        // push random\r\n        // this.var_fifos[i].push(Math.sin(this.simu_dt));\r\n        this.var_fifos[i].push(Math.random());\r\n      }\r\n\r\n      this.echartOption = {\r\n        xAxis: {\r\n          type: 'category',\r\n          // data: Object.keys(this.variables)\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        },\r\n        series: [{\r\n          name: 'vac',\r\n          data: this.var_fifos[0],\r\n        },\r\n        {\r\n          name: 'rms',\r\n          data: this.var_fifos[1],\r\n        },\r\n      ]};\r\n      this.chartInstance.setOption(this.echartOption);\r\n    },\r\n\r\n    ble_read() {\r\n      //we put data into v1 directly.\r\n    },\r\n\r\n    ble_write(arr) {\r\n      this.sendCommand(arr);\r\n    },\r\n    addTodo(lab) {\r\n      console.log('todo added' + lab);\r\n      this.TodoItems.push({ id: uniqueId('todo-'), label: lab, done: false });\r\n      console.log(this.v1.version());\r\n      console.log(this.v1.bs2str([48, 49, 50, 51]));\r\n    },\r\n\r\n    handleNotifications(event) {\r\n      let u8arr = new Uint8Array(event.target.value.buffer);\r\n      // console.log('> ', (u8arr));\r\n      // this.v1.rxdata.set(value.buffer);\r\n      // this.v1.rxdata.buffer = this._appendBuffer(this.v1.rxdata.buffer, value.buffer);\r\n      this.v1.rxdata_input(u8arr);\r\n\r\n      //parse data\r\n      /*\r\n      typedef struct __attribute__((packed))\r\n      {\r\n          uint16_t vdc_realtime;\r\n          uint16_t vac_rms;\r\n          uint16_t vdc;\r\n          uint16_t ibus_ma;\r\n          int16_t temp_m0;\r\n          int16_t temp_m1;\r\n          int16_t temp_mos;\r\n          pwr_fsm_e power_fsm;//size4 int\r\n      } upload_data_t;\r\n       */\r\n      // if (u8arr.length == 15) {\r\n      //   //use dataview\r\n      //   let dv = new DataView(u8arr.buffer);\r\n      //   let vdc_realtime = dv.getUint16(0, true);\r\n      //   let vac_rms = dv.getUint16(2, true);\r\n      //   let vdc = dv.getUint16(4, true);\r\n      //   let ibus_ma = dv.getUint16(6, true);\r\n      //   let temp_m0 = dv.getInt16(8, true);\r\n      //   let temp_m1 = dv.getInt16(10, true);\r\n      //   let temp_mos = dv.getInt16(12, true);\r\n      //   let power_fsm = dv.getUint8(14, true);\r\n        \r\n      //   console.log('vdc_realtime:' + vdc_realtime);\r\n      //   console.log('vac_rms:' + vac_rms);\r\n      //   console.log('vdc:' + vdc);\r\n      //   console.log('ibus_ma:' + ibus_ma);\r\n      //   console.log('temp_m0:' + temp_m0);\r\n      //   console.log('temp_m1:' + temp_m1);\r\n      //   console.log('temp_mos:' + temp_mos);\r\n      //   console.log('power_fsm:' + power_fsm);\r\n      // }\r\n\r\n      //parse data format in string '/*v1,v2,v3,...*/'\r\n      let str = new TextDecoder().decode(u8arr);\r\n      console.log(str);\r\n      \r\n      this.parseUploadString(str);\r\n      // this.updatePlot();\r\n      // this.updatePlotFifo();\r\n      // this.logText += this.v1.ab2hex(u8arr);\r\n      this.logText += str;\r\n    },\r\n\r\n    send() {\r\n        // let cmd = new Uint8Array([0x1,0x64, 0, 0, 0, 0, 0, 0]);\r\n        // let value = document.querySelector('#tx').value;\r\n        //convert string to Uint8Array\r\n        // let ab = new TextEncoder().encode('fuck');\r\n        // this.sendCommand(ab);\r\n        this.v1.version_reqv1();\r\n    },\r\n\r\n    v1ota() {\r\n      this.v1.enter_upgrade_req();\r\n      //如果是直接settimout调用 this是html,没有v1这个对象\r\n      // setTimeout(()=>{\r\n      //   this.v1.start_upgrade_req();\r\n      // }, 2000);\r\n    },\r\n\r\n    append() {\r\n      this.v1.rxdata_input(new TextEncoder().encode('abcd'));\r\n      this.logText += this.v1.ab2hex(this.v1.rxdata);\r\n    },\r\n\r\n    clear() {\r\n      this.v1.rxdata_clear();\r\n      this.logText = '';\r\n    },\r\n    /**\r\n     * Send a command to the device.\r\n     * See http://wittidesign.com/en/developer/ for API.\r\n     *\r\n     * @param cmd The command bytes and associated data.\r\n     */\r\n    sendCommand(cmd) {\r\n      if (writeCharacteristic) {\r\n        // Handle one command at a time\r\n        if (busy) {\r\n          // Queue commands\r\n          commandQueue.push(cmd);\r\n          return Promise.resolve();\r\n        }\r\n        busy = true;\r\n\r\n\r\n        return writeCharacteristic.writeValue(cmd).then(() => {\r\n          // console.log('call send' + cmd);\r\n          busy = false;\r\n          // Get next command from queue\r\n          let nextCommand = commandQueue.shift();\r\n          if (nextCommand) {\r\n            this.sendCommand(nextCommand);\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        return Promise.resolve();\r\n      }\r\n    },\r\n\r\n    testBLE() {\r\n      console.log('btn');\r\n      navigator.bluetooth.requestDevice({\r\n        filters: [{\r\n          namePrefix: '@',\r\n        }],\r\n        optionalServices: ['0000fff0-0000-1000-8000-00805f9b34fb',\r\n          '0000fff1-0000-1000-8000-00805f9b34fb']\r\n      })\r\n        .then(device => {\r\n          console.log('Got device:', device.name);\r\n          console.log('id:', device.id);\r\n          return device.gatt.connect();\r\n        })\r\n        .then(server => {\r\n          console.log('server:', server);\r\n          gattServer = server;\r\n          return gattServer.getPrimaryService('0000fff0-0000-1000-8000-00805f9b34fb');\r\n        })\r\n        .then(service => {\r\n          console.log('> service:', service);\r\n          // commandService = service;\r\n          return service.getCharacteristic(0xfff1);\r\n        })\r\n        .then(characteristic => {\r\n          console.log('> characteristic:', characteristic);\r\n          if (characteristic.properties.read) {\r\n            // readCharacteristic = characteristic;\r\n            console.log('> characteristic has read');\r\n            // characteristic.readValue().then(value => {\r\n            //     console.log('> Read ' + value.getUint8(0));\r\n            // });\r\n          }\r\n          if (characteristic.properties.write) {\r\n            console.log('> characteristic has write');\r\n            // characteristic.writeValue(new Uint8Array([0x01]));\r\n            writeCharacteristic = characteristic;\r\n            // let cmd = new Uint8Array([0x1, 0x64, 0, 0, 0, 0, 0, 0]);\r\n            // this.sendCommand(cmd);\r\n          }\r\n\r\n          if (characteristic.properties.notify) {\r\n            console.log('> characteristic has notify');\r\n            return characteristic.startNotifications().then(() => {\r\n              console.log('> Notifications started');\r\n              characteristic.addEventListener('characteristicvaluechanged',\r\n                this.handleNotifications);\r\n            });\r\n          }\r\n          else {\r\n            console.log('> characteristic has no notify');\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.log('Argh! ' + error);\r\n        });\r\n    },\r\n    disconnect() {\r\n      if (gattServer) {\r\n        gattServer.disconnect();\r\n        writeCharacteristic = null;\r\n      }\r\n    },\r\n    handleFileLoaded(arr) {\r\n      console.log('file loaded to v1');\r\n      this.v1.upgrade_load_firmware(arr);\r\n      // console.log(this.v1.fw_data);\r\n      console.log(this.v1.package_upgrade_req(this.v1.UPPACK_SIZE, 0, 1));\r\n    },\r\n    up_show_progress(progress) {\r\n      // let progress = this.v1.upgrade_progress();\r\n      console.log(progress);\r\n      this.upgradeProgress = progress;\r\n      if (progress == 100) {\r\n        console.log('upgrade done');\r\n      }\r\n    },\r\n    \r\n    // str like /*v1,v2,v3,...*/\r\n    parseUploadString(s) {\r\n      if (s.startsWith('/*') && s.endsWith('*/')) {\r\n        s = s.substring(2, s.length - 2);\r\n      }\r\n      else {\r\n        // console.log('invalid upload string');\r\n        return;\r\n      }\r\n      let arr = s.split(',');\r\n      this.variables['vac'] = parseInt(arr[0]);\r\n      this.variables['vac_rms'] = parseInt(arr[1]);\r\n      this.variables['vdc'] = parseInt(arr[2]);\r\n      this.variables['ibus'] = parseInt(arr[3]);\r\n      this.variables['tempm0'] = parseInt(arr[4]);\r\n      this.variables['tempm1'] = parseInt(arr[5]);\r\n      this.variables['tempmos'] = parseInt(arr[6]);\r\n      this.variables['fsm_raw'] = parseInt(arr[7]);\r\n      this.variables['fsm_str'] = fsm2str[this.variables['fsm_raw']];\r\n      // console.log('vac:' + this.variables['vac']);\r\n      // console.log('vac_rms:' + this.variables['vac_rms']);\r\n      // console.log('vdc:' + this.variables['vdc']);\r\n      // console.log('ibus_ma:' + this.variables['ibus']);\r\n\r\n      // this.vac_rms = parseInt(arr[1]);\r\n      // this.vdc = parseInt(arr[2]);\r\n      // this.ibus = parseInt(arr[3]);\r\n      // this.tempm0 = parseInt(arr[4]);\r\n      // this.tempm1 = parseInt(arr[5]);\r\n      // this.tempmos = parseInt(arr[6]);\r\n      // this.fsm = parseInt(arr[7]);\r\n      // console.log('vdc_realtime:' + vdc_realtime);\r\n      // console.log('vac_rms:' + vac_rms);\r\n      // console.log('vdc:' + vdc);\r\n      // console.log('ibus_ma:' + ibus_ma);\r\n      // console.log('temp_m0:' + temp_m0);\r\n      // console.log('temp_m1:' + temp_m1);\r\n      // console.log('temp_mos:' + temp_mos);\r\n      // console.log('power_fsm:' + power_fsm);\r\n    },\r\n    \r\n  },\r\n\r\n  mounted() {\r\n    this.initChart();\r\n  },\r\n  \r\n  created() {\r\n    // setInterval(this.fakeSimuPlot, 100);\r\n    this.v1 = new Bmv1(this.ble_read, this.ble_write, this.up_show_progress, 4, 1, false, true);\r\n    //gen fake bin arr\r\n    for(let i = 0; i < 100; i++) {\r\n      this.binFile = new Uint8Array(20*1024);\r\n    }\r\n    this.v1.upgrade_load_firmware(this.binFile);\r\n    \r\n    // console.log(this.v1.enter_upgrade_req());\r\n    // console.log(this.v1.start_upgrade_req());\r\n    // console.log(this.v1.end_upgrade_req());\r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n/* Add some basic styling */\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n}\r\n\r\ntd {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n}\r\n\r\ntr:nth-child(even) {\r\n  background-color: #f2f2f2;\r\n}\r\n\r\n/* 全局样式 */\r\n.btn {\r\n  padding: 0.8rem 1rem 0.7rem;\r\n  border: 0.2rem solid #4d4d4d;\r\n  cursor: pointer;\r\n  text-transform: capitalize;\r\n}\r\n\r\n.btn__danger {\r\n  color: #fff;\r\n  background-color: #ca3c3c;\r\n  border-color: #bd2130;\r\n}\r\n\r\n.btn__filter {\r\n  border-color: lightgrey;\r\n}\r\n\r\n.btn__danger:focus {\r\n  outline-color: #c82333;\r\n}\r\n\r\n.btn__primary {\r\n  color: #fff;\r\n  background-color: #000;\r\n}\r\n\r\n.btn-group {\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.btn-group>* {\r\n  flex: 1 1 auto;\r\n}\r\n\r\n.btn-group>*+* {\r\n  margin-left: 0.8rem;\r\n}\r\n\r\n.label-wrapper {\r\n  margin: 0;\r\n  flex: 0 0 100%;\r\n  text-align: center;\r\n}\r\n\r\n[class*=\"__lg\"] {\r\n  display: inline-block;\r\n  width: 100%;\r\n  font-size: 1.9rem;\r\n}\r\n\r\n[class*=\"__lg\"]:not(:last-child) {\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n@media screen  {\r\n  [class*=\"__lg\"] {\r\n    font-size: 2.4rem;\r\n  }\r\n}\r\n\r\n.visually-hidden {\r\n  position: absolute;\r\n  height: 1px;\r\n  width: 1px;\r\n  overflow: hidden;\r\n  clip: rect(1px 1px 1px 1px);\r\n  clip: rect(1px, 1px, 1px, 1px);\r\n  clip-path: rect(1px, 1px, 1px, 1px);\r\n  white-space: nowrap;\r\n}\r\n\r\n[class*=\"stack\"]>* {\r\n  margin-top: 0;\r\n  margin-bottom: 0;\r\n}\r\n\r\n.stack-small>*+* {\r\n  margin-top: 1.25rem;\r\n}\r\n\r\n.stack-large>*+* {\r\n  margin-top: 2.5rem;\r\n}\r\n\r\n@media screen {\r\n  .stack-small>*+* {\r\n    margin-top: 1.4rem;\r\n  }\r\n\r\n  .stack-large>*+* {\r\n    margin-top: 2.8rem;\r\n  }\r\n}\r\n\r\n/* 全局样式结束 */\r\n#app {\r\n  background: #fff;\r\n  margin: 2rem auto;\r\n  padding: 1rem;\r\n  padding-top: 0;\r\n  position: relative;\r\n  box-shadow:\r\n    0 2px 4px 0 rgba(0, 0, 0, 0.2),\r\n    0 2.5rem 5rem 0 rgba(0, 0, 0, 0.1);\r\n  min-width: 800px;\r\n  max-width: 1200px;\r\n}\r\n\r\n@media screen {\r\n  #app {\r\n    padding: 4rem;\r\n  }\r\n}\r\n\r\n#app>* {\r\n  max-width: 100%;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n}\r\n\r\n/* #app>form {\r\n  max-width: 100%;\r\n} */\r\n\r\n#app h1 {\r\n  display: block;\r\n  min-width: 100%;\r\n  width: 100%;\r\n  text-align: center;\r\n  margin: 0;\r\n  margin-bottom: 1rem;\r\n}\r\n</style>\r\n\r\n","<template>\r\n    <div>\r\n      <input type=\"file\" @change=\"handleFile\">\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n        return {\r\n            localBinArr: null,\r\n        };\r\n    },\r\n    methods: {\r\n      handleFile(e) {\r\n        const file = e.target.files[0];\r\n        const reader = new FileReader();\r\n  \r\n        reader.onload = (e) => {\r\n        //   const arrayBuffer = e.target.result;\r\n            this.localBinArr = new Uint8Array(e.target.result);\r\n            console.log(this.localBinArr);\r\n          // 在这里将触发自定义事件 以通知父组件\r\n          this.$emit('file-loaded', this.localBinArr);\r\n        };\r\n  \r\n        reader.onerror = (e) => {\r\n          console.error('FileReader failed to read file', e);\r\n        };\r\n  \r\n        reader.readAsArrayBuffer(file);\r\n      }\r\n    },\r\n    // props: {\r\n    //     binArr: { type: Uint8Array, required: true },\r\n    // }\r\n  }\r\n  </script>\r\n  ","import { render } from \"./FileRead.vue?vue&type=template&id=52663bd8\"\nimport script from \"./FileRead.vue?vue&type=script&lang=js\"\nexport * from \"./FileRead.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\r\n    <div class=\"custom-checkbox\">\r\n        <input type=\"checkbox\" :id=\"id\" :checked='isDone' class=\"checkbox\" />\r\n        <label for=\"todo-item\" class=\"checkbox-label\">vue- {{ label }}</label>\r\n    </div>\r\n</template>\r\n\r\n\r\n\r\n<script>\r\n\r\n// import uniqueId from \"lodash.uniqueid\";\r\n\r\nexport default {\r\n    name: 'TodoItem',\r\n    props: {\r\n        label: { type: String, required: true },\r\n        // checked: { type:Boolean, default: false },\r\n        done: { default: false, type: Boolean },\r\n        id: { required: true, type: String },\r\n    },\r\n    data() {\r\n        return {\r\n            isDone: this.done,\r\n        };\r\n    },\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* .custom-checkbox>.checkbox-label {\r\n    font-family: Arial, sans-serif;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n    font-weight: 400;\r\n    font-size: 16px;\r\n    font-size: 1rem;\r\n    line-height: 1.25;\r\n    color: #0b0c0c;\r\n    display: block;\r\n    margin-bottom: 5px;\r\n}\r\n\r\n.custom-checkbox>.checkbox {\r\n    font-family: Arial, sans-serif;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n    font-weight: 400;\r\n    font-size: 16px;\r\n    font-size: 1rem;\r\n    line-height: 1.25;\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    height: 40px;\r\n    height: 2.5rem;\r\n    margin-top: 0;\r\n    padding: 5px;\r\n    border: 2px solid #0b0c0c;\r\n    border-radius: 0;\r\n    appearance: none;\r\n}\r\n\r\n.custom-checkbox>input:focus {\r\n    outline: 3px dashed #fd0;\r\n    outline-offset: 0;\r\n    box-shadow: inset 0 0 0 2px;\r\n}\r\n\r\n.custom-checkbox {\r\n    font-family: Arial, sans-serif;\r\n    -webkit-font-smoothing: antialiased;\r\n    font-weight: 400;\r\n    font-size: 1.6rem;\r\n    line-height: 1.25;\r\n    display: block;\r\n    position: relative;\r\n    min-height: 40px;\r\n    margin-bottom: 10px;\r\n    padding-left: 40px;\r\n    clear: left;\r\n}\r\n\r\n.custom-checkbox>input[type=\"checkbox\"] {\r\n    -webkit-font-smoothing: antialiased;\r\n    cursor: pointer;\r\n    position: absolute;\r\n    z-index: 1;\r\n    top: -2px;\r\n    left: -2px;\r\n    width: 44px;\r\n    height: 44px;\r\n    margin: 0;\r\n    opacity: 0;\r\n}\r\n\r\n.custom-checkbox>.checkbox-label {\r\n    font-size: inherit;\r\n    font-family: inherit;\r\n    line-height: inherit;\r\n    display: inline-block;\r\n    margin-bottom: 0;\r\n    padding: 8px 15px 5px;\r\n    cursor: pointer;\r\n    touch-action: manipulation;\r\n}\r\n\r\n.custom-checkbox>label::before {\r\n    content: \"\";\r\n    box-sizing: border-box;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 40px;\r\n    height: 40px;\r\n    border: 2px solid currentcolor;\r\n    background: transparent;\r\n}\r\n\r\n.custom-checkbox>input[type=\"checkbox\"]:focus+label::before {\r\n    border-width: 4px;\r\n    outline: 3px dashed #228bec;\r\n}\r\n\r\n.custom-checkbox>label::after {\r\n    box-sizing: content-box;\r\n    content: \"\";\r\n    position: absolute;\r\n    top: 11px;\r\n    left: 9px;\r\n    width: 18px;\r\n    height: 7px;\r\n    transform: rotate(-45deg);\r\n    border: solid;\r\n    border-width: 0 0 5px 5px;\r\n    border-top-color: transparent;\r\n    opacity: 0;\r\n    background: transparent;\r\n}\r\n\r\n.custom-checkbox>input[type=\"checkbox\"]:checked+label::after {\r\n    opacity: 1;\r\n}\r\n\r\n@media only screen and (min-width: 4100rem) {\r\n\r\n    label,\r\n    input,\r\n    .custom-checkbox {\r\n        font-size: 19px;\r\n        font-size: 1.9rem;\r\n        line-height: 1.31579;\r\n    }\r\n} */\r\n</style>","import { render } from \"./TodoItem.vue?vue&type=template&id=56ed032d&scoped=true\"\nimport script from \"./TodoItem.vue?vue&type=script&lang=js\"\nexport * from \"./TodoItem.vue?vue&type=script&lang=js\"\n\nimport \"./TodoItem.vue?vue&type=style&index=0&id=56ed032d&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-56ed032d\"]])\n\nexport default __exports__","<template>\r\n    <form @submit.prevent=\"addTodo\">\r\n        <h2 class=\"label-wrapper\">\r\n            <label for=\"todo-item\" class=\"label__lg\">Add a new todo</label>\r\n        </h2>\r\n\r\n        <input type=\"text\" placeholder=\"Add a new todo\" id=\"new-todo-input\" autocomplete=\"off\" v-model.trim=\"label\"\r\n            class=\"input__lg\" />\r\n        <button type=\"submit\" class=\"btn btn__primary btn__lg\">Add</button>\r\n\r\n    </form>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    methods: {\r\n        addTodo() {\r\n            if (!this.label) return;\r\n            // console.log(\"addTodo label value\", this.label);\r\n            this.$emit(\"add-todo\", this.label);\r\n            this.label = \"\";\r\n        },\r\n    },\r\n};\r\n</script>","import { render } from \"./TodoForm.vue?vue&type=template&id=b295b2da\"\nimport script from \"./TodoForm.vue?vue&type=script&lang=js\"\nexport * from \"./TodoForm.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","\r\n// this file contains the javascript functions for the bmv1 c lib\r\n// generate js functions like bmv1.py\r\n\r\n/* eslint-disable */\r\n\r\n//send a bmv1 format protocol frame.\r\nconst LOCAL_TYPE_HOST = 0xa;\r\nconst LOCAL_ID = 0x0;\r\n\r\nconst BMV1_TYPE_M1502 = 1;\r\nconst BMV1_TYPE_P1010 = 2;\r\nconst BMV1_TYPE_M1101 = 4;\r\nconst BMV1_TYPE_USBCAN = 0xB;\r\n\r\n\r\nfunction crc8_maxim (array) {\r\n    const CRC8_DATA = [\r\n      0, 94, 188, 226, 97, 63, 221, 131, 194, 156, 126, 32, 163, 253, 31, 65,\r\n      157, 195, 33, 127, 252, 162, 64, 30, 95, 1, 227, 189, 62, 96, 130, 220,\r\n      35, 125, 159, 193, 66, 28, 254, 160, 225, 191, 93, 3, 128, 222, 60, 98,\r\n      190, 224, 2, 92, 223, 129, 99, 61, 124, 34, 192, 158, 29, 67, 161, 255,\r\n      70, 24, 250, 164, 39, 121, 155, 197, 132, 218, 56, 102, 229, 187, 89, 7,\r\n      219, 133, 103, 57, 186, 228, 6, 88, 25, 71, 165, 251, 120, 38, 196, 154,\r\n      101, 59, 217, 135, 4, 90, 184, 230, 167, 249, 27, 69, 198, 152, 122, 36,\r\n      248, 166, 68, 26, 153, 199, 37, 123, 58, 100, 134, 216, 91, 5, 231, 185,\r\n      140, 210, 48, 110, 237, 179, 81, 15, 78, 16, 242, 172, 47, 113, 147, 205,\r\n      17, 79, 173, 243, 112, 46, 204, 146, 211, 141, 111, 49, 178, 236, 14, 80,\r\n      175, 241, 19, 77, 206, 144, 114, 44, 109, 51, 209, 143, 12, 82, 176, 238,\r\n      50, 108, 142, 208, 83, 13, 239, 177, 240, 174, 76, 18, 145, 207, 45, 115,\r\n      202, 148, 118, 40, 171, 245, 23, 73, 8, 86, 180, 234, 105, 55, 213, 139,\r\n      87, 9, 235, 181, 54, 104, 138, 212, 149, 203, 41, 119, 244, 170, 72, 22,\r\n      233, 183, 85, 11, 136, 214, 52, 106, 43, 117, 151, 201, 74, 20, 246, 168,\r\n      116, 42, 200, 150, 21, 75, 169, 247, 182, 232, 10, 84, 215, 137, 107, 53]\r\n  \r\n    // const i = 0\r\n    // const i2 = array.length\r\n    let b = 0\r\n    for (let index = 0; index < array.length; index++) {\r\n      b = CRC8_DATA[b ^ array[index] & 0xff]\r\n    }\r\n    return b\r\n}\r\n\r\n//test array = [0x30, 0x31, 0x32, 0x33];\r\n//output should be 0xBBBB \r\nfunction crc16_xmodem(array) {\r\n    let crc = 0x0000;\r\n    const polynomial = 0x1021;\r\n    let byte_val, bit, c15;\r\n    for (let i = 0; i < array.length; i++) {\r\n      byte_val = array[i]\r\n      for (let k = 0; k < 8; k++) {\r\n        bit = ((byte_val >> (7 - k) & 1) == 1);\r\n        c15 = ((crc >> 15 & 1) == 1);\r\n        crc <<= 1;\r\n        if (c15 ^ bit) {\r\n          crc ^= polynomial;\r\n        }\r\n      }\r\n    }\r\n    crc &= 0xffff;\r\n    return crc;\r\n}\r\n\r\n/*\r\n**  CRC-16/8005\r\n**  Descriptions: CRC16 checksum function poly:0x8005\r\n**  Input:        Data to check,Stream length, initialized checksum\r\n**  Output:       CRC checksum uint16\r\n*/\r\nfunction crc16_arc8005(array)\r\n{\r\n    const CRC16_TAB = [0x0000, 0xc0c1, 0xc181, 0x0140, 0xc301, 0x03c0, 0x0280, 0xc241, 0xc601,\r\n\t\t0x06c0, 0x0780, 0xc741, 0x0500, 0xc5c1, 0xc481, 0x0440, 0xcc01, 0x0cc0,\r\n\t\t0x0d80, 0xcd41, 0x0f00, 0xcfc1, 0xce81, 0x0e40, 0x0a00, 0xcac1, 0xcb81,\r\n\t\t0x0b40, 0xc901, 0x09c0, 0x0880, 0xc841, 0xd801, 0x18c0, 0x1980, 0xd941,\r\n\t\t0x1b00, 0xdbc1, 0xda81, 0x1a40, 0x1e00, 0xdec1, 0xdf81, 0x1f40, 0xdd01,\r\n\t\t0x1dc0, 0x1c80, 0xdc41, 0x1400, 0xd4c1, 0xd581, 0x1540, 0xd701, 0x17c0,\r\n\t\t0x1680, 0xd641, 0xd201, 0x12c0, 0x1380, 0xd341, 0x1100, 0xd1c1, 0xd081,\r\n\t\t0x1040, 0xf001, 0x30c0, 0x3180, 0xf141, 0x3300, 0xf3c1, 0xf281, 0x3240,\r\n\t\t0x3600, 0xf6c1, 0xf781, 0x3740, 0xf501, 0x35c0, 0x3480, 0xf441, 0x3c00,\r\n\t\t0xfcc1, 0xfd81, 0x3d40, 0xff01, 0x3fc0, 0x3e80, 0xfe41, 0xfa01, 0x3ac0,\r\n\t\t0x3b80, 0xfb41, 0x3900, 0xf9c1, 0xf881, 0x3840, 0x2800, 0xe8c1, 0xe981,\r\n\t\t0x2940, 0xeb01, 0x2bc0, 0x2a80, 0xea41, 0xee01, 0x2ec0, 0x2f80, 0xef41,\r\n\t\t0x2d00, 0xedc1, 0xec81, 0x2c40, 0xe401, 0x24c0, 0x2580, 0xe541, 0x2700,\r\n\t\t0xe7c1, 0xe681, 0x2640, 0x2200, 0xe2c1, 0xe381, 0x2340, 0xe101, 0x21c0,\r\n\t\t0x2080, 0xe041, 0xa001, 0x60c0, 0x6180, 0xa141, 0x6300, 0xa3c1, 0xa281,\r\n\t\t0x6240, 0x6600, 0xa6c1, 0xa781, 0x6740, 0xa501, 0x65c0, 0x6480, 0xa441,\r\n\t\t0x6c00, 0xacc1, 0xad81, 0x6d40, 0xaf01, 0x6fc0, 0x6e80, 0xae41, 0xaa01,\r\n\t\t0x6ac0, 0x6b80, 0xab41, 0x6900, 0xa9c1, 0xa881, 0x6840, 0x7800, 0xb8c1,\r\n\t\t0xb981, 0x7940, 0xbb01, 0x7bc0, 0x7a80, 0xba41, 0xbe01, 0x7ec0, 0x7f80,\r\n\t\t0xbf41, 0x7d00, 0xbdc1, 0xbc81, 0x7c40, 0xb401, 0x74c0, 0x7580, 0xb541,\r\n\t\t0x7700, 0xb7c1, 0xb681, 0x7640, 0x7200, 0xb2c1, 0xb381, 0x7340, 0xb101,\r\n\t\t0x71c0, 0x7080, 0xb041, 0x5000, 0x90c1, 0x9181, 0x5140, 0x9301, 0x53c0,\r\n\t\t0x5280, 0x9241, 0x9601, 0x56c0, 0x5780, 0x9741, 0x5500, 0x95c1, 0x9481,\r\n\t\t0x5440, 0x9c01, 0x5cc0, 0x5d80, 0x9d41, 0x5f00, 0x9fc1, 0x9e81, 0x5e40,\r\n\t\t0x5a00, 0x9ac1, 0x9b81, 0x5b40, 0x9901, 0x59c0, 0x5880, 0x9841, 0x8801,\r\n\t\t0x48c0, 0x4980, 0x8941, 0x4b00, 0x8bc1, 0x8a81, 0x4a40, 0x4e00, 0x8ec1,\r\n\t\t0x8f81, 0x4f40, 0x8d01, 0x4dc0, 0x4c80, 0x8c41, 0x4400, 0x84c1, 0x8581,\r\n\t\t0x4540, 0x8701, 0x47c0, 0x4680, 0x8641, 0x8201, 0x42c0, 0x4380, 0x8341,\r\n\t\t0x4100, 0x81c1, 0x8081, 0x4040];\r\n\r\n    let u16 = 0;\r\n    // for (let i = 0; i < array.length; i++) {\r\n    //     u16 = (u16 >> 8) ^ CRC16_TAB[(u16 ^ array[i]) & 0x00ff];\r\n    // }\r\n    // be care about js bit shift\r\n    for (let i = 0; i < array.length; i++) {\r\n        u16 = ((u16 >> 8) ^ CRC16_TAB[(u16 ^ array[i]) & 0x00ff]) & 0xffff;\r\n    }\r\n    return u16;\r\n}\r\n\r\n//npm install --save js-crypto-aes // npm\r\n// import aes from 'js-crypto-aes'\r\nvar aesjs = require('aes-js');\r\n//import aes.js in local dir\r\n// import {aesjs} from './aes.js';\r\n\r\n\r\n// const msg = new TextEncoder().encode('-FFFF0000-FFFF0000-FFFF0000-'); // arbitrary length of message in Uint8Array\r\nconst msg = new Uint8Array(new TextEncoder().encode('-FFFF0000-FFFF0000-FFFF0000-')); // arbitrary length of message in Uint8Array\r\nconst key = new Uint8Array([0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c]); // 16 bytes or 32 bytes key in Uint8Array\r\n// const iv = new Uint8Array(12); // 12 bytes IV in Uint8Array for AES-CTR mode\r\n//after enc, you get an Uint8Array of encrypted message\r\nconst emsg = new Uint8Array([80,177,45,74,92,136,169,131,14,111,182,1,255,93,100,95,103,34,80,6,114,247,248,143,158,196,86,148]);\r\n\r\n// def bm_aes_enc(data):\r\n//     bmkey = [0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c] #秘钥\r\n//     bmkey = bytes(bmkey)\r\n//     aes = AES.new(bmkey, AES.MODE_CTR, counter=Counter.new(128, initial_value=0))\r\n//     return aes.encrypt(data)\r\n\r\n//accoding to python aes code, write js version aes\r\n// const enc = aes.encrypt(msg, key, {name: 'AES-CBC', iv});\r\n// The counter is optional, and if omitted will begin at 1\r\n// var aes_ctr0 = new aesjs.ModeOfOperation.ctr(key, new aesjs.Counter(0));\r\n// var aes_ctr1 = new aesjs.ModeOfOperation.ctr(key, new aesjs.Counter(0));\r\n// var enc = aes_ctr0.encrypt(msg);\r\n// // const enc = aesjs.utils.hex.fromBytes(msg);\r\n// console.log(enc);\r\n// const dec = aes_ctr1.encrypt(enc);\r\n// console.log(dec);\r\n// if (dec !== emsg) {\r\n//     console.log('enc failed');\r\n// }\r\n// console.log('after dec' + new TextDecoder().decode(dec));\r\n\r\nclass BufferManager {\r\n    constructor(initialCapacity = 1024) {\r\n        this.buffer = new Uint8Array(initialCapacity);\r\n        this.length = 0;\r\n    }\r\n\r\n    ensureCapacity(additionalLength) {\r\n        const requiredLength = this.length + additionalLength;\r\n        if (requiredLength <= this.buffer.length) {\r\n            return;\r\n        }\r\n\r\n        let newCapacity = this.buffer.length;\r\n        while (newCapacity < requiredLength) {\r\n            newCapacity *= 2; // Double the capacity until it fits the required length\r\n        }\r\n\r\n        // Create a new buffer with the new capacity and copy the old data into it\r\n        const newBuffer = new Uint8Array(newCapacity);\r\n        newBuffer.set(this.buffer.subarray(0, this.length));\r\n        this.buffer = newBuffer;\r\n    }\r\n\r\n    appendBuffer(additionalBuffer) {\r\n        this.ensureCapacity(additionalBuffer.byteLength);\r\n        this.buffer.set(new Uint8Array(additionalBuffer), this.length);\r\n        this.length += additionalBuffer.byteLength;\r\n    }\r\n\r\n    getBuffer() {\r\n        // Return a subarray view of the actual data\r\n        return this.buffer.subarray(0, this.length);\r\n    }\r\n}\r\n\r\n\r\nexport var Bmv1 = function(read, write, up_cb, receiver_type = BMV1_TYPE_M1101, receiver_id = 1, debug_tx = true, debug_rx = true) {\r\n    this.CMDID_GET_VERSION_REQ      = (0x0001)\r\n    this.CMDID_GET_VERSION_ACK      = (0x0002)\r\n    this.__CMDID_ENTER_UPGRADE_REQ    = (0x000A)\r\n    this.__CMDID_ENTER_UPGRADE_ACK    = (0x000B)\r\n    this.__CMDID_START_UPGRADE_REQ    = (0x000C)\r\n    this.__CMDID_START_UPGRADE_ACK    = (0x000D)\r\n    this.__CMDID_PACKAGE_UPGRADE_REQ  = (0x000E)\r\n    this.__CMDID_PACKAGE_UPGRADE_ACK  = (0x000F)\r\n    this.__CMDID_END_UPGRADE_REQ      = (0x0010)\r\n    this.__CMDID_END_UPGRADE_ACK      = (0x0011)\r\n    this.UPPACK_SIZE = 128;\r\n    \r\n    \r\n    \r\n    this.read = read;   // read function\r\n    this.write = write;\r\n    this.up_progress_hook = up_cb; // upgrade callback function\r\n\r\n    // this.__crc8_func = crcmod.predefined.mkCrcFun('crc-8-maxim')\r\n    // this.__crc16_func = crcmod.predefined.mkCrcFun('crc-16')\r\n    this.__crc8_func = crc8_maxim;\r\n    // this.__crc16_func = crc16_xmodem;//0is correct\r\n    this.__crc16_func = crc16_arc8005;\r\n\r\n    this.__aes_key = [0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c];\r\n\r\n    //symmetric encryption \r\n    this.aes_xcrypt = (arr)=>{\r\n        var aesctr = new aesjs.ModeOfOperation.ctr(this.__aes_key, new aesjs.Counter(0));\r\n        return aesctr.encrypt(arr);\r\n    }\r\n\r\n    // this.aes_xcrypt = aes.encrypt;//FIXME\r\n    // this.aes_decrypt = aes.decrypt;//FIXME\r\n\r\n    this.local_type = LOCAL_TYPE_HOST;\r\n    this.local_id = LOCAL_ID;\r\n    this.rx_type = receiver_type\r\n    this.rx_id = receiver_id\r\n    this.__debug_tx = debug_tx;\r\n    this.__debug_rx = debug_rx;\r\n\r\n    \r\n    //use buffer manager to avoid allocate memory frequently\r\n    //but need maintain buffer length manually, fuck!\r\n    // this.bufferManager = new BufferManager();\r\n    // this.rxdata = this.bufferManager.getBuffer();\r\n    this.rxdata = new Uint8Array([]);\r\n    this.fw_data = [];\r\n\r\n    this.up_step = 0;\r\n    this.up_successful_count = 0;\r\n    // this.up_progress_hook;\r\n    this.up_log_hook ;\r\n    this.upgrade_end_hook;\r\n    this.end_flag = 0;\r\n\r\n    // self.cmd_handlers = {}   #dict\r\n    this.cmd_handlers = null;\r\n    // # v0使用req_cmdid+1作为ack v1使用相同cmdid作为ack\r\n\r\n    // # self.cmd_handlers[self.CMDID_GET_VERSION_ACK] = self.version_ack_handler\r\n    // this.cmd_handlers.set();\r\n    // this.cmd_handlers.set();\r\n    // this.cmd_handlers.set();\r\n    // this.cmd_handlers.set();\r\n\r\n\r\n    this.append_buffer = (buffer1, buffer2) => {\r\n        // Ensure the first buffer has a byteLength property; if not, default to 0\r\n        let b1l = buffer1 && buffer1.byteLength ? buffer1.byteLength : 0;\r\n        // Create a new Uint8Array with a length equal to the sum of both buffers\r\n        let tmp = new Uint8Array(b1l + buffer2.byteLength);\r\n        // If the first buffer is defined and has content, set it into the new array\r\n        if (buffer1) {\r\n            tmp.set(new Uint8Array(buffer1), 0);\r\n        }\r\n        // Set the second buffer into the new array starting at the end of the first\r\n        tmp.set(new Uint8Array(buffer2), b1l);\r\n        return tmp;\r\n    };\r\n\r\n    // this.rxdata_input_bm = (arr) => {\r\n    //     let buffer2 = arr instanceof ArrayBuffer ? arr : new Uint8Array(arr).buffer;\r\n    //     this.bufferManager.appendBuffer(buffer2);\r\n    //     this.rxdata = this.bufferManager.getBuffer();\r\n    // }\r\n    \r\n    this.rxdata_input = (arr) => {\r\n        // Ensure that arr is an instance of ArrayBuffer; if not, convert it\r\n        let buffer2 = arr instanceof ArrayBuffer ? arr : new Uint8Array(arr).buffer;\r\n        // Append the new data to this.rxdata and reassign it\r\n        this.rxdata = this.append_buffer(this.rxdata.buffer, buffer2);\r\n    };\r\n\r\n    this.rxdata_clear = () => {\r\n        // this.bufferManager = new BufferManager();\r\n        this.rxdata = new Uint8Array([]);\r\n    }\r\n    \r\n    \r\n    //how can i load xx.bin file in nodejs?\r\n    this.upgrade_load_firmware = (data)=>{\r\n        this.fw_data = data;\r\n        this.fw_size = data.length;\r\n        // with open(fn, 'rb') as f:\r\n        //     self.fw_data = f.read()\r\n        // self.fw_size = os.path.getsize(fn)\r\n    }\r\n\r\n    this.register_cmd_handler = (cmdid, handler)=>{\r\n        this.cmd_handlers[cmdid] = handler;\r\n    }\r\n\r\n    this.version = () => {\r\n        return \"bmv1 ddt\";\r\n    }\r\n\r\n    // sof len16 crc8 cmdid data ...crc16\r\n    this.header_size = function header_size() {\r\n        return 6;\r\n    }\r\n    \r\n    // v0 + seq + sender + receiver + attr\r\n    this.headerv1_size = function headerv1_size() {\r\n        return 6 + 7;\r\n    }\r\n\r\n    this.__bs2str = function __bs2str(bs) {\r\n        var str = '';\r\n        for (var i = 0; i < bs.length; i++) {\r\n            str += bs[i].toString(16) + ' ';\r\n        }\r\n        return str;\r\n    }\r\n\r\n    this.ab2hex = function ab2hex(buffer) {\r\n        var hexArr = Array.prototype.map.call(\r\n            new Uint8Array(buffer),\r\n            function (bit) {\r\n                return ('00' + bit.toString(16)).toUpperCase().slice(-2)\r\n            }\r\n        )\r\n        return hexArr.join('');\r\n    }\r\n\r\n    this.bs2str = function bs2str(bs) {return this.__bs2str(bs);}\r\n    \r\n    this.dmv0_protocol_pack = function (cmdid, data) {\r\n        var header_len = this.header_size();\r\n        var buffer = new Uint8Array(header_len);\r\n        buffer[0] = 'd'.charCodeAt(0);\r\n        var total_len = header_len + data.length + 2;\r\n        buffer[1] = total_len&0xff;\r\n        buffer[2] = total_len>>8;\r\n        // buffer[3] = crc8_func(bs, crc=0x77)   //with crc init\r\n        buffer[3] = this.__crc8_func(buffer.slice(0, 3));\r\n        //buffer[3] = crc8.crcValue    //header crc8\r\n\r\n        buffer[4] = cmdid & 0xff;\r\n        buffer[5] = cmdid >> 8;\r\n\r\n        buffer.set(data, 6);\r\n        var crc16 = this.__crc16_func(buffer);\r\n        buffer[buffer.length-2] = crc16&0xff;\r\n        buffer[buffer.length-1] = crc16>>8;\r\n\r\n        if (this.__debug_tx) {\r\n            console.log(this.__bs2str(buffer));\r\n        }\r\n    }\r\n\r\n    this.dmv1_protocol_pack = (cmdid, data, seq,\r\n        sender_type, sender_id,\r\n        receiver_type, receiver_id,\r\n        is_enc, is_ack) => \r\n    {\r\n        var header_len = this.headerv1_size();\r\n        var buffer = new Uint8Array(header_len+data.length+2);\r\n        buffer[0] = 'd'.charCodeAt(0);\r\n        var total_len = header_len + data.length + 2;\r\n        buffer[1] = total_len&0xff;\r\n        buffer[2] = (total_len>>8) | (0x1<<4);\r\n        // buffer[3] = crc8_func(bs, crc=0x77)   //with crc init\r\n        buffer[3] = this.__crc8_func(buffer.slice(0, 3));\r\n\r\n        buffer[4] = cmdid & 0xff;\r\n        buffer[5] = cmdid >> 8;\r\n\r\n        buffer[6] = seq & 0xff;\r\n        buffer[7] = seq >> 8;\r\n        // self.seq += 1\r\n        // struct __PACKED\r\n        // {\r\n        //     uint8_t type : 4;\r\n        //     uint8_t id : 4;\r\n        // } sender;\r\n        // struct __PACKED\r\n        // {\r\n        //     uint8_t type : 4;\r\n        //     uint8_t id : 4;\r\n        // } receiver;\r\n        // buffer[8] = sender_type&0xf | (sender_id << 4)\r\n        // buffer[9] = receiver_type&0xf | (receiver_id << 4)\r\n\r\n        buffer[8] = sender_id;\r\n        buffer[9] = sender_type;\r\n        buffer[10] = receiver_id;\r\n        buffer[11] = receiver_type;\r\n\r\n        // struct __PACKED\r\n        // {\r\n        //     uint8_t encrypt_type : 2;\r\n        //     uint8_t reserve : 4;\r\n        //     uint8_t need_ack : 1;\r\n        //     uint8_t cmd_type : 1; \r\n        // } attr;\r\n        // 00是req明文包 80是ack明文\r\n        // 01是req加密包 81是ack不过可以不带数据了\r\n        buffer[12] = is_enc | (is_ack << 8);\r\n\r\n        buffer.set(data, 13);\r\n        var crc16 = this.__crc16_func(buffer.slice(0, buffer.length-2));\r\n        buffer[buffer.length-2] = crc16&0xff;\r\n        buffer[buffer.length-1] = crc16>>8;\r\n\r\n        if (this.__debug_tx) {\r\n            console.log(this.__bs2str(buffer), 'crc16:');\r\n        }\r\n        \r\n        if (this.write) {\r\n            this.write(buffer, (self.local_type<<8) | self.local_id);\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    this.version_req = function () {\r\n        return this.dmv0_protocol_pack(this.CMDID_GET_VERSION_REQ, new Uint8Array([1,2,3,4]));\r\n    }\r\n\r\n    this.version_reqv1  = function () {\r\n        return this.dmv1_protocol_pack(\r\n            this.CMDID_GET_VERSION_REQ,\r\n            new Uint8Array([1,2,3,4]), 0,\r\n            this.local_type, this.local_id,\r\n            this.rx_type, this.rx_id,\r\n            0, 0);\r\n    }\r\n\r\n    this.version_ack = (data) => {\r\n        // var res, pack_size = unpack('<BHxx', data);\r\n        var dv = new DataView(data.buffer);\r\n        var res = dv.getUint8(0);\r\n        var pack_size = dv.getUint16(1, true);\r\n        console.log('version ack handler called {}, {}'+(res, pack_size));\r\n        if (res == 0) {\r\n            this.up_step += 1;\r\n            this.enter_upgrade_req();\r\n        }\r\n    },\r\n\r\n    this.enter_upgrade_req = function () {\r\n        console.log(\"--entering upgrade \");\r\n        var cmdid = 0x000a;\r\n        var revs0 = 0;\r\n        var revs1 = 0;\r\n        var bs = new Uint8Array(8);\r\n        // v0 = self.dmv0_protocol_pack(self.__CMDID_ENTER_UPGRADE_REQ, bs)\r\n        // return v0\r\n        return this.dmv1_protocol_pack(this.__CMDID_ENTER_UPGRADE_REQ, bs, this.seq,\r\n            this.local_type, this.local_id,\r\n            this.rx_type, this.rx_id, 0, 0);\r\n        // time.sleep(1)\r\n        // this.up_log('--enter upgrade req, waiting for 1s')\r\n    }\r\n\r\n    this.enter_upgrade_ack = (data) => {\r\n        // 主动进行下一步开始升级命令\r\n        console.log(\"--enter upgrade ok\");\r\n        // time.sleep(1) #等待app进入loader再发开始升级\r\n        this.start_upgrade_req();\r\n        // v0 = self.dmv0_protocol_pack(self.__CMDID_ENTER_UPGRADE_REQ, bs)\r\n        // return v0\r\n        // v1 = self.dmv1_protocol_pack(self.__CMDID_ENTER_UPGRADE_ACK, bs, self.seq, \r\n        //                              self.local_type, 0,\r\n        //                              self.rx_type, self.rx_id, 0, 0)\r\n        // return v1\r\n    }\r\n\r\n    this.start_upgrade_req = function () {\r\n        var param_start_addr = 0x08008000 - 0x800;\r\n        var param_size = 0x100;\r\n        var firmware_start_addr = 0x08008000;\r\n        var firmware_size = this.fw_size;\r\n        var hardware_code = 0xcdab8967;\r\n        var jump2app_delay = 300;\r\n        var revs32 = 0;\r\n        this.upgrade_progress = 0;\r\n        var bs = new Uint8Array(28);\r\n        // bs = pack('<iiiiiii', 0,0,0,self.fw_size, 0,0,0)   #little endian\r\n        var dv = new DataView(bs.buffer);\r\n        dv.setInt32(0, 0, true);\r\n        dv.setInt32(4, 0, true);\r\n        dv.setInt32(8, 0, true);\r\n        dv.setInt32(12, this.fw_size, true);\r\n        dv.setInt32(16, 0, true);\r\n        dv.setInt32(20, 0, true);\r\n\r\n        console.log(\"--starting upgrade\");\r\n        // v0 = self.dmv0_protocol_pack(self.__CMDID_START_UPGRADE_REQ, bs)\r\n        return this.dmv1_protocol_pack(this.__CMDID_START_UPGRADE_REQ, bs, this.seq,\r\n            this.local_type, this.local_id,\r\n            this.rx_type, this.rx_id, 0, 0);\r\n    }\r\n\r\n    this.start_upgrade_ack = (data) => {\r\n        // var res, pack_size = unpack('<BHxx', data);\r\n        var dv = new DataView(data.buffer);\r\n        var res = dv.getUint8(0);\r\n        var pack_size = dv.getUint16(1, true);\r\n        console.log('start upgrade ack handler called {}, {}'+(res, pack_size));\r\n        if (res == 0) {\r\n            this.up_step += 1;\r\n            this.package_upgrade_req(this.UPPACK_SIZE, 0, 1);\r\n        }\r\n    }\r\n\r\n    this.package_upgrade_req = function (package_size, package_idx, enc=0) {\r\n        var rd_start = package_idx * package_size; //let it be n * 16  total = 20.\r\n        var current_package_size = package_size;\r\n        if (rd_start + package_size <= this.fw_size) {\r\n            current_package_size = package_size;\r\n        } else {\r\n            current_package_size = this.fw_size - rd_start;\r\n        }\r\n        var fw_start = package_idx * package_size;\r\n        var fw_end = fw_start + current_package_size;\r\n        var buffer = this.fw_data.slice(fw_start, fw_end);\r\n        // req = package_upgrade_req_t()\r\n        var req_encrypt_type = enc;\r\n        var req_package_index = package_idx;\r\n        var req_package_size = current_package_size;\r\n        var req_buf;\r\n        if (enc) {\r\n            // aes = MyAES(self.key, self.iv)\r\n            req_buf = this.aes_xcrypt(buffer);\r\n        } else {\r\n            req_buf = buffer;\r\n        }\r\n        this.up_last_pack_seq = req_package_index;\r\n        // print('buffer len', len(buffer))\r\n        var bs = new Uint8Array(9 + req_buf.length);\r\n        // bs = pack('<BiI256s', req_encrypt_type, req_package_index, req_package_size, req_buf)   //little endian\r\n        var dv = new DataView(bs.buffer);\r\n        dv.setUint8(0, req_encrypt_type);\r\n        dv.setInt32(1, req_package_index, true);\r\n        dv.setInt32(5, req_package_size, true);\r\n        bs.set(req_buf, 9);\r\n        // return self.dmv0_protocol_pack(self.__CMDID_PACKAGE_UPGRADE_REQ, bs)\r\n        return this.dmv1_protocol_pack(this.__CMDID_PACKAGE_UPGRADE_REQ, bs, this.seq,\r\n            this.local_type, this.local_id,\r\n            this.rx_type, this.rx_id, 0, 0);\r\n    }\r\n\r\n    this.pack_up_retry = function () {\r\n        console.log( 'retry package :{}'+(this.up_last_pack_seq) );\r\n        this.package_upgrade_req(this.UPPACK_SIZE, this.up_last_pack_seq, 1);\r\n    }\r\n\r\n    this.package_upgrade_ack = (data) => {\r\n        // var res, package_index = unpack('<Bixx', data);\r\n        var dv = new DataView(data.buffer);\r\n        var res = dv.getUint8(0);\r\n        var package_index = dv.getInt32(1, true);\r\n        // print('package upgrade ack handler called', res, package_index)\r\n        var total_package_cnt = Math.floor( this.fw_size / this.UPPACK_SIZE );\r\n        if (this.fw_size % this.UPPACK_SIZE) {\r\n            total_package_cnt += 1;\r\n        }\r\n        var upgrade_end_index = total_package_cnt - 1;\r\n\r\n        // print(\"package upgrade ack ok. ack pack \", package_index, '/', upgrade_end_index)\r\n        if (res == 0) {\r\n            this.up_step += 1;\r\n            // console.log(`pack  index ${package_index}/${upgrade_end_index}`);\r\n            if (package_index == this.up_last_pack_seq && package_index < upgrade_end_index) {\r\n                this.package_upgrade_req(this.UPPACK_SIZE, package_index + 1, 1);\r\n                // self.retry_timer.cancel()\r\n                // self.retry_timer = threading.Timer(0.5, self.pack_up_retry)\r\n                // self.retry_timer.start()\r\n                // console.log('pack up ack ok {}{}{}{}{}'+(package_index, '/', upgrade_end_index, 'tx', package_index + 1));\r\n                console.log(`pack up ack ok ${package_index}/${upgrade_end_index} tx ${package_index + 1}`);\r\n                var progress = Math.ceil(100 * package_index / upgrade_end_index);\r\n                if (this.up_progress_hook) {\r\n                    this.up_progress_hook(progress);\r\n                }\r\n            } else if (package_index == upgrade_end_index) {\r\n                console.log('end of up, tx end req ');\r\n                // self.retry_timer.cancel()\r\n                this.end_upgrade_req();\r\n            } else {\r\n                console.log('package ack failed, index mismatch retry last pack{}'+(this.up_last_pack_seq) );\r\n                this.package_upgrade_req(this.UPPACK_SIZE, this.up_last_pack_seq, 1);\r\n            }\r\n        }\r\n    \r\n    }\r\n\r\n    this.end_upgrade_req = function () {\r\n        console.log(\"--ending upgrade\");\r\n        var firmware_digest_type = 0;\r\n        // var md5 = new js_md5();\r\n        // md5.update(this.fw_data);\r\n        // console.log('md5=', md5.hexdigest());\r\n        // var md5_digest = md5.hexdigest();\r\n        var md5_digest = new Uint8Array(16);\r\n\r\n        // var sha256 = new js_sha256();\r\n        // sha256.update(md5_digest);\r\n        // sha256.update(this.uid);\r\n        var sha256 = new Uint8Array(32);\r\n        // console.log('sha256 of md5 & uid=', sha256.hexdigest());\r\n        // var sha256_digest = sha256.hexdigest();\r\n        var sha256_digest = new Uint8Array(32);\r\n        var crc16 = this.__crc16_func(this.fw_data);\r\n        console.log(`crc16 of fw = ${crc16}`);\r\n        // resv = bytearray(32)\r\n        var data = new Uint8Array(52);\r\n        // data = pack('<HH16s32s', firmware_digest_type, crc16, md5_digest, sha256_digest)   //little endian\r\n        var dv = new DataView(data.buffer);\r\n        dv.setUint16(0, firmware_digest_type, true);\r\n        dv.setUint16(2, crc16, true);\r\n        dv.setUint8(4, md5_digest);\r\n        dv.setUint8(20, sha256_digest);\r\n        // return self.dmv0_protocol_pack(self.__CMDID_END_UPGRADE_REQ, data)\r\n        return this.dmv1_protocol_pack(this.__CMDID_END_UPGRADE_REQ, data, this.seq,\r\n            this.local_type, this.local_id,\r\n            this.rx_type, this.rx_id, 0, 0);\r\n    \r\n    }\r\n\r\n    this.end_upgrade_ack = (data) => {\r\n        // data = data[:3] #only 3bytes\r\n        // res = unpack('<Bxx', data)\r\n        var dv = new DataView(data.buffer);\r\n        var res = dv.getUint8(0);\r\n        console.log('end upgrade ack handler called {}'+(res) );\r\n        this.up_step = 0xff;\r\n        this.up_successful_count+=1;\r\n        console.log(\"upgrade successful. {}\"+(this.up_successful_count) );\r\n        if (this.upgrade_end_hook) {\r\n            this.upgrade_end_hook();\r\n        }\r\n    }\r\n\r\n    \r\n\r\n    this.dmv0_unpack_frame = (data) => {\r\n        //find sof\r\n        var i = 0;\r\n        while (i < data.length && data[i] != 0x64) {\r\n            i += 1;\r\n        }\r\n        data = data.slice(i);   //remove front.\r\n        if (0 == data.length) {\r\n            return;\r\n        }\r\n    \r\n        //check head\r\n        var head3 = data.slice(0, 3);\r\n        if (this.__crc8_func(head3) == data[3]) {\r\n            //crc8 ok\r\n            var head6 = data.slice(0, this.header_size());\r\n            // var sof, size, crc8, cmdid = unpack('<cHcH', head6);\r\n            var dv = new DataView(head6.buffer);\r\n            var sof = dv.getUint8(0);\r\n            var size = dv.getUint16(1, true);\r\n            var crc8 = dv.getUint8(3);\r\n            var cmdid = dv.getUint16(4, true);\r\n\r\n            var frame_data = data.slice(this.header_size(), size);\r\n            var frame = head6.concat(frame_data);\r\n            \r\n            if (this.__debug_rx) {\r\n                console.log('frame_size:%d cmdid:%2x fifo remain:%d'+(size, cmdid, data.length));\r\n            }\r\n            var crc16 = (frame_data[-1] << 8) + frame_data[-2];\r\n            if (crc16 == this.__crc16_func(frame.slice(0, size-2))) {\r\n                //if whole frame crc16 pass. remove from fifo.\r\n                // print('crc16 pass') #no msg = good msg.\r\n                if (this.cmd_handlers.has(cmdid)) {\r\n                    this.cmd_handlers.get(cmdid)(frame_data);   //需要crc16 unpack末尾需要加入xx\r\n                }\r\n            } else {\r\n                console.log('crc16 fail');\r\n            }\r\n            //crc16 pass or fail. remove frame from fifo.\r\n            data = data.slice(size);\r\n        } else {\r\n            data = data.slice(4);\r\n            // pass\r\n            // print('crc8 fail')\r\n            // self.rxdata = self.rxdata[3:]\r\n        }\r\n    }\r\n\r\n    // 解析数据 如果解析成功返回当前帧的长度 然后截断原始数据\r\n    // 如果不足一帧则返回等待下一次调用. 不可在函数中切数据，因为是浅拷贝\r\n    this.dmv1_unpack_frame = (data) => {\r\n        //find sof\r\n        var unvalid_len = 0;\r\n        var i = 0;\r\n        while (i < data.length && data[i] != 0x64) {\r\n            i += 1;\r\n        }\r\n        data = data.slice(i);   //remove front.\r\n        //每一帧都以至少headv1+CRC16的形式发送。若不足，则返回等待足够长度\r\n        if (data.length < this.headerv1_size()) {\r\n            return i+data.length;\r\n        }\r\n        \r\n        unvalid_len = i;\r\n\r\n        if (this.__debug_rx) {\r\n            // console.log(\"rdata:\", this.__bs2str(data));\r\n        }\r\n        // self.logger.info(\"rdata:{}\"+(self.__bs2str(rdata)))\r\n        if (data[1] == 0x64) {\r\n            data = data.slice(1);\r\n            unvalid_len += 1;\r\n        }\r\n        //check head\r\n        var head3 = data.slice(0, 3);\r\n        try {\r\n            if (this.__crc8_func(head3) == data[3]) {\r\n                //crc8 ok\r\n                // var sof, size = unpack('<cH', head3);\r\n                var dv = new DataView(head3.buffer);\r\n                var sof = dv.getUint8(0);\r\n                var size = dv.getUint16(1, true);\r\n                size = size & 0xfff;\r\n                //检查是否能已接收完整一帧\r\n                if (data.length < size) {\r\n                    return -2;\r\n                    // return 0\r\n                }\r\n                // print('wanted size enough:', size)\r\n                var frame = data.slice(0, size);\r\n                var headv1 = data.slice(0, this.headerv1_size());\r\n                // var sof, size, crc8, cmdid, seq, sender, receiver, attr = unpack('<cHcHHHHB', headv1);\r\n                var dv = new DataView(headv1.buffer);\r\n                var sof1 = dv.getUint8(0);\r\n                var size = dv.getUint16(1, true);\r\n                var crc8 = dv.getUint8(3);\r\n                var cmdid = dv.getUint16(4, true);\r\n                var seq = dv.getUint16(6, true);\r\n                var sender = dv.getUint16(8, true);\r\n                var receiver = dv.getUint16(10, true);\r\n                var attr = dv.getUint8(12);\r\n                size = size & 0xfff;\r\n                var frame_data = data.slice(this.headerv1_size(), size);\r\n                // frame = headv1 + frame_data\r\n\r\n                if (this.__debug_rx) {\r\n                    // console.log('frame_size:%d cmdid:%2x fifo remain:%d'+(size, cmdid, data.length));\r\n                    console.log(`frame_size:${size} cmdid:${cmdid}:%2x fifo remain:${data.length}`);\r\n                    console.log(`[sender]:${sender} => [receiver]:${receiver} attr:${attr}`);\r\n                }\r\n                var crc16 = (frame_data[frame_data.length-1] << 8) + frame_data[frame_data.length-2];//js dont support -index\r\n                // if crc16 == self.__crc16_func(frame[:-2]):\r\n                if (true) {\r\n                    //if whole frame crc16 pass. remove from fifo.\r\n                    // print('crc16 pass') #no msg = good msg.\r\n                    if (this.cmd_handlers.has(cmdid)) {\r\n                        this.cmd_handlers.get(cmdid)(frame_data);   //需要crc16 unpack末尾需要加入xx\r\n                        this.last_cmdid = cmdid;\r\n                    }\r\n                } else {\r\n                    console.log('crc16 fail');\r\n                }\r\n                //crc16 pass or fail. remove frame from fifo.\r\n                // rdata[:] = rdata[size :] #FIXME 此处截断头不会影响can_rxdata\r\n                return size+unvalid_len;  //更新的偏离要加上帧头‘d’的偏离，否则无法修正后续的缓存偏离\r\n                // print('fifo remain:%d' % (len(rdata)))\r\n            }\r\n            else {\r\n                console.warn(\"error head:{}, crc:{}\"+(this.__bs2str(head3), this.__crc8_func(head3)));\r\n                console.warn(\"buffer:{}\"+(this.__bs2str(data)));\r\n                return -3;\r\n            }\r\n        }\r\n        catch (e) {\r\n            console.warn(\"Exception:{}\"+(head3));\r\n            return -4;\r\n        }\r\n    }\r\n\r\n    this.unpack_loopv0 = function (data) {\r\n        // self.logger.debug('unpack loop called')\r\n        var header_len = this.header_size();\r\n        var header = data.slice(0, header_len);\r\n        var total_len = header[1] | (header[2] << 8);\r\n        var cmdid = header[4] | (header[5] << 8);\r\n        var crc16 = header[total_len - 2] | (header[total_len - 1] << 8);\r\n        var crc16_calc = this.__crc16_func(header);\r\n        if (crc16_calc != crc16) {\r\n            console.warn('crc16 check failed', crc16, crc16_calc);\r\n            return;\r\n        }\r\n        var payload = data.slice(header_len, total_len - 2);\r\n        // self.logger.debug('unpack loop called {} {} {}'+(header_len, total_len, cmdid))\r\n        if (this.cmd_handlers.has(cmdid)) {\r\n            this.cmd_handlers.get(cmdid)(payload);\r\n        }\r\n    }\r\n\r\n    this.unpack_loopv1 = function (u8a) {\r\n        if (u8a.length > 0) {\r\n            console.log('rx q len:' , u8a.length);\r\n            var frame_size = this.dmv1_unpack_frame(u8a);\r\n            if (frame_size > 0) {   //parse ok if > 0\r\n                this.rxdata = this.rxdata.slice(frame_size);\r\n            }\r\n        }\r\n    }\r\n\r\n    //10ms call\r\n    this.start_unpack_thread = function () {\r\n        // self.logger.debug('unpack thread started')\r\n\r\n        this.cmd_handlers = new Map([\r\n            [this.CMDID_GET_VERSION_REQ, this.version_ack.bind(this)],\r\n            [this.__CMDID_ENTER_UPGRADE_REQ, this.enter_upgrade_ack.bind(this)],\r\n            [this.__CMDID_START_UPGRADE_REQ, this.start_upgrade_ack.bind(this)],\r\n            [this.__CMDID_PACKAGE_UPGRADE_REQ, this.package_upgrade_ack.bind(this)],\r\n            [this.__CMDID_END_UPGRADE_REQ, this.end_upgrade_ack.bind(this)],\r\n        ]);\r\n        console.log(this.cmd_handlers);\r\n\r\n        setInterval( ()=> {\r\n            this.unpack_loopv1(this.rxdata);\r\n        }, 10);\r\n        console.warn('call once.');\r\n    }\r\n\r\n    \r\n    this.start_unpack_thread(); //call when init\r\n    \r\n}\r\n\r\n// test code : nodejs bmv1.js\r\n// data = ['0','1', '2', '3'];\r\n// data = [0x30, 0x31, 0x32, 0x33];\r\n// crc16 = crc16_arc8005(data);\r\n// console.log(crc16);\r\n// console.log(crc16_xmodem(data));\r\n// v1 = new Bmv1();\r\n// console.log(v1.bs2str(data));\r\n// console.log(Bmv1.CMDID_GET_VERSION_REQ);\r\n// console.log(v1.headerv1_size());\r\n//usage: var v1 = new Bmv1(read, write);\r\n// v1.enter_upgrade_req();\r\n// v1.xxx\r\n\r\n// var sftp = require('ssh2-sftp-client');\r\n// var fs = require('fs');\r\n// var path = require('path');\r\n\r\n// fs.readFile(path.join(__dirname, 'aes.js'), 'utf8', function (err, data) {\r\n//     if (err) {\r\n//         return console.log(err);\r\n//     }\r\n//     console.log(data.slice(0, 100));\r\n// });\r\n","import { render } from \"./App.vue?vue&type=template&id=6f63a11e\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=6f63a11e&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\r\nimport App from './App.vue'\r\n\r\nimport './assets/reset.css'\r\n\r\ncreateApp(App).mount('#app')\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/fit/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkvue0\"] = self[\"webpackChunkvue0\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(9637); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["_createElementVNode","class","alt","src","_imports_0","width","height","ref","style","_createElementBlock","onClick","_cache","args","$options","testBLE","disconnect","send","append","clear","v1ota","$event","$data","logText","id","rows","cols","_hoisted_1","_Fragment","_renderList","variables","value","name","key","_toDisplayString","type","upgradeProgress","_hoisted_2","_hoisted_3","_createVNode","_component_file_read","onFileLoaded","handleFileLoaded","_hoisted_4","_component_todo_form","onAddTodo","addTodo","_hoisted_5","TodoItems","item","_component_todo_item","label","done","_hoisted_6","_hoisted_7","onChange","handleFile","data","localBinArr","methods","e","file","target","files","reader","FileReader","onload","this","Uint8Array","result","console","log","$emit","onerror","error","readAsArrayBuffer","__exports__","for","$props","checked","isDone","props","String","required","default","Boolean","onSubmit","_withModifiers","placeholder","autocomplete","_ctx","trim","LOCAL_TYPE_HOST","LOCAL_ID","BMV1_TYPE_M1101","crc8_maxim","array","CRC8_DATA","b","index","length","crc16_arc8005","CRC16_TAB","u16","i","aesjs","require","TextEncoder","encode","Bmv1","read","write","up_cb","receiver_type","receiver_id","debug_tx","debug_rx","CMDID_GET_VERSION_REQ","CMDID_GET_VERSION_ACK","__CMDID_ENTER_UPGRADE_REQ","__CMDID_ENTER_UPGRADE_ACK","__CMDID_START_UPGRADE_REQ","__CMDID_START_UPGRADE_ACK","__CMDID_PACKAGE_UPGRADE_REQ","__CMDID_PACKAGE_UPGRADE_ACK","__CMDID_END_UPGRADE_REQ","__CMDID_END_UPGRADE_ACK","UPPACK_SIZE","up_progress_hook","__crc8_func","__crc16_func","__aes_key","aes_xcrypt","arr","aesctr","ModeOfOperation","ctr","Counter","encrypt","local_type","local_id","rx_type","rx_id","__debug_tx","__debug_rx","rxdata","fw_data","up_step","up_successful_count","up_log_hook","upgrade_end_hook","end_flag","cmd_handlers","append_buffer","buffer1","buffer2","b1l","byteLength","tmp","set","rxdata_input","ArrayBuffer","buffer","rxdata_clear","upgrade_load_firmware","fw_size","register_cmd_handler","cmdid","handler","version","header_size","headerv1_size","__bs2str","bs","str","toString","ab2hex","hexArr","Array","prototype","map","call","bit","toUpperCase","slice","join","bs2str","dmv0_protocol_pack","header_len","charCodeAt","total_len","crc16","dmv1_protocol_pack","seq","sender_type","sender_id","is_enc","is_ack","self","version_req","version_reqv1","version_ack","dv","DataView","res","getUint8","pack_size","getUint16","enter_upgrade_req","enter_upgrade_ack","start_upgrade_req","upgrade_progress","setInt32","start_upgrade_ack","package_upgrade_req","package_size","package_idx","enc","rd_start","current_package_size","req_buf","fw_start","fw_end","req_encrypt_type","req_package_index","req_package_size","up_last_pack_seq","setUint8","pack_up_retry","package_upgrade_ack","package_index","getInt32","total_package_cnt","Math","floor","upgrade_end_index","progress","ceil","end_upgrade_req","firmware_digest_type","md5_digest","sha256_digest","setUint16","end_upgrade_ack","dmv0_unpack_frame","head3","head6","size","frame_data","frame","concat","has","get","dmv1_unpack_frame","unvalid_len","headv1","sender","receiver","attr","last_cmdid","warn","unpack_loopv0","header","crc16_calc","payload","unpack_loopv1","u8a","frame_size","start_unpack_thread","Map","bind","setInterval","gattServer","writeCharacteristic","commandQueue","busy","FIFO_CNT","fsm2str","components","TodoItem","TodoForm","FileRead","uniqueId","binFile","v1","var_fifos","simu_dt","echartOption","legend","chartInstance","initChart","echarts","$refs","chart","option","xAxis","yAxis","series","Object","values","setOption","updatePlot","updatePlotFifo","shift","push","keys","fakeSimuPlot","random","ble_read","ble_write","sendCommand","lab","handleNotifications","event","u8arr","TextDecoder","decode","parseUploadString","cmd","Promise","resolve","writeValue","then","nextCommand","navigator","bluetooth","requestDevice","filters","namePrefix","optionalServices","device","gatt","connect","server","getPrimaryService","service","getCharacteristic","characteristic","properties","notify","startNotifications","addEventListener","catch","up_show_progress","s","startsWith","endsWith","substring","split","parseInt","mounted","created","render","createApp","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","deferred","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","every","splice","r","n","getter","__esModule","d","a","definition","o","defineProperty","enumerable","g","globalThis","Function","window","obj","prop","hasOwnProperty","Symbol","toStringTag","p","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","forEach","__webpack_exports__"],"sourceRoot":""}