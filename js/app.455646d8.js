(function(){"use strict";var t={9677:function(t,e,i){var s=i(9242),r=i(3396),n=i(7139),a=i.p+"img/image.57fdd1ba.webp";const o=(0,r._)("br",null,null,-1),l=["value"],c=(0,r._)("br",null,null,-1),_=(0,r._)("h1",null,"TODO List",-1),h={"aria-labelledby":"list-summary",class:"stack_large"},d=(0,r._)("img",{alt:"Vue logo",src:a,width:"500",height:"500"},null,-1),u={ref:"chart",style:{width:"500px",height:"500px"}};function p(t,e,i,a,p,f){const g=(0,r.up)("file-read"),v=(0,r.up)("todo-form"),b=(0,r.up)("todo-item");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("button",{class:"btn btn__lg btn-group",onClick:e[0]||(e[0]=(...t)=>f.testBLE&&f.testBLE(...t))},"BLE"),(0,r._)("button",{class:"btn btn__danger btn-group",onClick:e[1]||(e[1]=(...t)=>f.disconnect&&f.disconnect(...t))},"disconnect"),(0,r._)("button",{class:"btn",onClick:e[2]||(e[2]=(...t)=>f.send&&f.send(...t))},"send"),(0,r._)("button",{class:"btn",onClick:e[3]||(e[3]=(...t)=>f.append&&f.append(...t))},"append"),(0,r._)("button",{class:"btn",onClick:e[4]||(e[4]=(...t)=>f.clear&&f.clear(...t))},"clear"),(0,r._)("button",{class:"btn",onClick:e[5]||(e[5]=(...t)=>f.v1ota&&f.v1ota(...t))},"v1ota"),(0,r.wy)((0,r._)("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>p.logText=t),id:"log",rows:"10",cols:"40"},null,512),[[s.nr,p.logText]]),o,(0,r._)("table",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(p.variables,((t,e)=>((0,r.wg)(),(0,r.iD)("tr",{key:e},[(0,r._)("td",null,(0,n.zw)(e),1),(0,r._)("td",null,(0,n.zw)(t),1)])))),128))]),(0,r._)("input",{type:"range",id:"up_progress",value:p.upgradeProgress},null,8,l),c,(0,r.Wm)(g,{onFileLoaded:f.handleFileLoaded},null,8,["onFileLoaded"]),_,(0,r.Wm)(v,{onAddTodo:f.addTodo},null,8,["onAddTodo"]),(0,r._)("ul",h,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(p.TodoItems,(t=>((0,r.wg)(),(0,r.iD)("li",{key:t.id},[(0,r.Wm)(b,{label:t.label,done:t.done,id:t.id},null,8,["label","done","id"])])))),128))]),d,(0,r._)("div",u,null,512)])}i(4224),i(1121),i(7133),i(560);function f(t,e,i,s,n,a){return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("input",{type:"file",onChange:e[0]||(e[0]=(...t)=>a.handleFile&&a.handleFile(...t))},null,32)])}var g={data(){return{localBinArr:null}},methods:{handleFile(t){const e=t.target.files[0],i=new FileReader;i.onload=t=>{this.localBinArr=new Uint8Array(t.target.result),console.log(this.localBinArr),this.$emit("file-loaded",this.localBinArr)},i.onerror=t=>{console.error("FileReader failed to read file",t)},i.readAsArrayBuffer(e)}}},v=i(89);const b=(0,v.Z)(g,[["render",f]]);var m=b;const w={class:"custom-checkbox"},y=["id","checked"],A={for:"todo-item",class:"checkbox-label"};function D(t,e,i,s,a,o){return(0,r.wg)(),(0,r.iD)("div",w,[(0,r._)("input",{type:"checkbox",id:i.id,checked:a.isDone,class:"checkbox"},null,8,y),(0,r._)("label",A,"vue- "+(0,n.zw)(i.label),1)])}var k={name:"TodoItem",props:{label:{type:String,required:!0},done:{default:!1,type:Boolean},id:{required:!0,type:String}},data(){return{isDone:this.done}}};const E=(0,v.Z)(k,[["render",D],["__scopeId","data-v-56ed032d"]]);var U=E;const x=(0,r._)("h2",{class:"label-wrapper"},[(0,r._)("label",{for:"todo-item",class:"label__lg"},"Add a new todo")],-1),I=(0,r._)("button",{type:"submit",class:"btn btn__primary btn__lg"},"Add",-1);function C(t,e,i,n,a,o){return(0,r.wg)(),(0,r.iD)("form",{onSubmit:e[1]||(e[1]=(0,s.iM)(((...t)=>o.addTodo&&o.addTodo(...t)),["prevent"]))},[x,(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Add a new todo",id:"new-todo-input",autocomplete:"off","onUpdate:modelValue":e[0]||(e[0]=e=>t.label=e),class:"input__lg"},null,512),[[s.nr,t.label,void 0,{trim:!0}]]),I],32)}var P={methods:{addTodo(){this.label&&(this.$emit("add-todo",this.label),this.label="")}}};const R=(0,v.Z)(P,[["render",C]]);var T=R,S=i(2e3),O=i.n(S);const q=10,F=0,M=4;function G(t){const e=[0,94,188,226,97,63,221,131,194,156,126,32,163,253,31,65,157,195,33,127,252,162,64,30,95,1,227,189,62,96,130,220,35,125,159,193,66,28,254,160,225,191,93,3,128,222,60,98,190,224,2,92,223,129,99,61,124,34,192,158,29,67,161,255,70,24,250,164,39,121,155,197,132,218,56,102,229,187,89,7,219,133,103,57,186,228,6,88,25,71,165,251,120,38,196,154,101,59,217,135,4,90,184,230,167,249,27,69,198,152,122,36,248,166,68,26,153,199,37,123,58,100,134,216,91,5,231,185,140,210,48,110,237,179,81,15,78,16,242,172,47,113,147,205,17,79,173,243,112,46,204,146,211,141,111,49,178,236,14,80,175,241,19,77,206,144,114,44,109,51,209,143,12,82,176,238,50,108,142,208,83,13,239,177,240,174,76,18,145,207,45,115,202,148,118,40,171,245,23,73,8,86,180,234,105,55,213,139,87,9,235,181,54,104,138,212,149,203,41,119,244,170,72,22,233,183,85,11,136,214,52,106,43,117,151,201,74,20,246,168,116,42,200,150,21,75,169,247,182,232,10,84,215,137,107,53];let i=0;for(let s=0;s<t.length;s++)i=e[i^255&t[s]];return i}function z(t){const e=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];let i=0;for(let s=0;s<t.length;s++)i=65535&(i>>8^e[255&(i^t[s])]);return i}var K=i(3585);new Uint8Array((new TextEncoder).encode("-FFFF0000-FFFF0000-FFFF0000-")),new Uint8Array([43,126,21,22,40,174,210,166,171,247,21,136,9,207,79,60]),new Uint8Array([80,177,45,74,92,136,169,131,14,111,182,1,255,93,100,95,103,34,80,6,114,247,248,143,158,196,86,148]);var V=function(t,e,i,s=M,r=1,n=!0,a=!0){this.CMDID_GET_VERSION_REQ=1,this.CMDID_GET_VERSION_ACK=2,this.__CMDID_ENTER_UPGRADE_REQ=10,this.__CMDID_ENTER_UPGRADE_ACK=11,this.__CMDID_START_UPGRADE_REQ=12,this.__CMDID_START_UPGRADE_ACK=13,this.__CMDID_PACKAGE_UPGRADE_REQ=14,this.__CMDID_PACKAGE_UPGRADE_ACK=15,this.__CMDID_END_UPGRADE_REQ=16,this.__CMDID_END_UPGRADE_ACK=17,this.UPPACK_SIZE=128,this.read=t,this.write=e,this.up_progress_hook=i,this.__crc8_func=G,this.__crc16_func=z,this.__aes_key=[43,126,21,22,40,174,210,166,171,247,21,136,9,207,79,60],this.aes_xcrypt=t=>{var e=new K.ModeOfOperation.ctr(this.__aes_key,new K.Counter(0));return e.encrypt(t)},this.local_type=q,this.local_id=F,this.rx_type=s,this.rx_id=r,this.__debug_tx=n,this.__debug_rx=a,this.rxdata=new Uint8Array([]),this.fw_data=[],this.up_step=0,this.up_successful_count=0,this.up_log_hook,this.upgrade_end_hook,this.end_flag=0,this.cmd_handlers=null,this.append_buffer=(t,e)=>{let i=t&&t.byteLength?t.byteLength:0,s=new Uint8Array(i+e.byteLength);return t&&s.set(new Uint8Array(t),0),s.set(new Uint8Array(e),i),s},this.rxdata_input=t=>{let e=t instanceof ArrayBuffer?t:new Uint8Array(t).buffer;this.rxdata=this.append_buffer(this.rxdata.buffer,e)},this.rxdata_clear=()=>{this.rxdata=new Uint8Array([])},this.upgrade_load_firmware=t=>{this.fw_data=t,this.fw_size=t.length},this.register_cmd_handler=(t,e)=>{this.cmd_handlers[t]=e},this.version=()=>"bmv1 ddt",this.header_size=function(){return 6},this.headerv1_size=function(){return 13},this.__bs2str=function(t){for(var e="",i=0;i<t.length;i++)e+=t[i].toString(16)+" ";return e},this.ab2hex=function(t){var e=Array.prototype.map.call(new Uint8Array(t),(function(t){return("00"+t.toString(16)).toUpperCase().slice(-2)}));return e.join("")},this.bs2str=function(t){return this.__bs2str(t)},this.dmv0_protocol_pack=function(t,e){var i=this.header_size(),s=new Uint8Array(i);s[0]="d".charCodeAt(0);var r=i+e.length+2;s[1]=255&r,s[2]=r>>8,s[3]=this.__crc8_func(s.slice(0,3)),s[4]=255&t,s[5]=t>>8,s.set(e,6);var n=this.__crc16_func(s);s[s.length-2]=255&n,s[s.length-1]=n>>8,this.__debug_tx&&console.log(this.__bs2str(s))},this.dmv1_protocol_pack=(t,e,i,s,r,n,a,o,l)=>{var c=this.headerv1_size(),_=new Uint8Array(c+e.length+2);_[0]="d".charCodeAt(0);var h=c+e.length+2;_[1]=255&h,_[2]=h>>8|16,_[3]=this.__crc8_func(_.slice(0,3)),_[4]=255&t,_[5]=t>>8,_[6]=255&i,_[7]=i>>8,_[8]=r,_[9]=s,_[10]=a,_[11]=n,_[12]=o|l<<8,_.set(e,13);var d=this.__crc16_func(_.slice(0,_.length-2));return _[_.length-2]=255&d,_[_.length-1]=d>>8,this.__debug_tx&&console.log(this.__bs2str(_),"crc16:"),this.write&&this.write(_,self.local_type<<8|self.local_id),_},this.version_req=function(){return this.dmv0_protocol_pack(this.CMDID_GET_VERSION_REQ,new Uint8Array([1,2,3,4]))},this.version_reqv1=function(){return this.dmv1_protocol_pack(this.CMDID_GET_VERSION_REQ,new Uint8Array([1,2,3,4]),0,this.local_type,this.local_id,this.rx_type,this.rx_id,0,0)},this.version_ack=t=>{var e=new DataView(t.buffer),i=e.getUint8(0),s=e.getUint16(1,!0);console.log("version ack handler called {}, {}"+s),0==i&&(this.up_step+=1,this.enter_upgrade_req())},this.enter_upgrade_req=function(){console.log("--entering upgrade ");var t=new Uint8Array(8);return this.dmv1_protocol_pack(this.__CMDID_ENTER_UPGRADE_REQ,t,this.seq,this.local_type,this.local_id,this.rx_type,this.rx_id,0,0)},this.enter_upgrade_ack=t=>{console.log("--enter upgrade ok"),this.start_upgrade_req()},this.start_upgrade_req=function(){this.fw_size;this.upgrade_progress=0;var t=new Uint8Array(28),e=new DataView(t.buffer);return e.setInt32(0,0,!0),e.setInt32(4,0,!0),e.setInt32(8,0,!0),e.setInt32(12,this.fw_size,!0),e.setInt32(16,0,!0),e.setInt32(20,0,!0),console.log("--starting upgrade"),this.dmv1_protocol_pack(this.__CMDID_START_UPGRADE_REQ,t,this.seq,this.local_type,this.local_id,this.rx_type,this.rx_id,0,0)},this.start_upgrade_ack=t=>{var e=new DataView(t.buffer),i=e.getUint8(0),s=e.getUint16(1,!0);console.log("start upgrade ack handler called {}, {}"+s),0==i&&(this.up_step+=1,this.package_upgrade_req(this.UPPACK_SIZE,0,1))},this.package_upgrade_req=function(t,e,i=0){var s=e*t,r=t;r=s+t<=this.fw_size?t:this.fw_size-s;var n,a=e*t,o=a+r,l=this.fw_data.slice(a,o),c=i,_=e,h=r;n=i?this.aes_xcrypt(l):l,this.up_last_pack_seq=_;var d=new Uint8Array(9+n.length),u=new DataView(d.buffer);return u.setUint8(0,c),u.setInt32(1,_,!0),u.setInt32(5,h,!0),d.set(n,9),this.dmv1_protocol_pack(this.__CMDID_PACKAGE_UPGRADE_REQ,d,this.seq,this.local_type,this.local_id,this.rx_type,this.rx_id,0,0)},this.pack_up_retry=function(){console.log("retry package :{}"+this.up_last_pack_seq),this.package_upgrade_req(this.UPPACK_SIZE,this.up_last_pack_seq,1)},this.package_upgrade_ack=t=>{var e=new DataView(t.buffer),i=e.getUint8(0),s=e.getInt32(1,!0),r=this.fw_size/this.UPPACK_SIZE;this.fw_size%this.UPPACK_SIZE&&(r+=1);var n=r-1;if(0==i)if(this.up_step+=1,s==this.up_last_pack_seq&&s<n){this.package_upgrade_req(this.UPPACK_SIZE,s+1,1),console.log(`pack up ack ok ${s}/${n} tx ${s+1}`);var a=Math.ceil(100*s/n);this.up_progress_hook&&this.up_progress_hook(a)}else s==n?(console.log("end of up, tx end req "),this.end_upgrade_req()):(console.log("package ack failed, index mismatch retry last pack{}"+this.up_last_pack_seq),this.package_upgrade_req(this.UPPACK_SIZE,this.up_last_pack_seq,1))},this.end_upgrade_req=function(){console.log("--ending upgrade");var t=0,e=new Uint8Array(16),i=(new Uint8Array(32),new Uint8Array(32)),s=this.__crc16_func(this.fw_data);console.log("crc16=%04x"%s);var r=new Uint8Array(52),n=new DataView(r.buffer);return n.setUint16(0,t,!0),n.setUint16(2,s,!0),n.setUint8(4,e),n.setUint8(20,i),this.dmv1_protocol_pack(this.__CMDID_END_UPGRADE_REQ,r,this.seq,this.local_type,this.local_id,this.rx_type,this.rx_id,0,0)},this.end_upgrade_ack=t=>{var e=new DataView(t.buffer),i=e.getUint8(0);console.log("end upgrade ack handler called {}"+i),this.up_step=255,this.up_successful_count+=1,console.log("upgrade successful. {}"+this.up_successful_count),this.upgrade_end_hook&&this.upgrade_end_hook()},this.dmv0_unpack_frame=t=>{var e=0;while(e<t.length&&100!=t[e])e+=1;if(t=t.slice(e),0!=t.length){var i=t.slice(0,3);if(this.__crc8_func(i)==t[3]){var s=t.slice(0,this.header_size()),r=new DataView(s.buffer),n=(r.getUint8(0),r.getUint16(1,!0)),a=(r.getUint8(3),r.getUint16(4,!0)),o=t.slice(this.header_size(),n),l=s.concat(o);this.__debug_rx&&console.log("frame_size:%d cmdid:%2x fifo remain:%d"+t.length);var c=(o[-1]<<8)+o[-2];c==this.__crc16_func(l.slice(0,n-2))?this.cmd_handlers.has(a)&&this.cmd_handlers.get(a)(o):console.log("crc16 fail"),t=t.slice(n)}else t=t.slice(4)}},this.dmv1_unpack_frame=t=>{var e=0,i=0;while(i<t.length&&100!=t[i])i+=1;if(t=t.slice(i),t.length<this.headerv1_size())return i+t.length;e=i,this.__debug_rx,100==t[1]&&(t=t.slice(1),e+=1);var s=t.slice(0,3);try{if(this.__crc8_func(s)==t[3]){var r=new DataView(s.buffer),n=(r.getUint8(0),r.getUint16(1,!0));if(n&=4095,t.length<n)return-2;t.slice(0,n);var a=t.slice(0,this.headerv1_size()),o=(r=new DataView(a.buffer),r.getUint8(0),n=r.getUint16(1,!0),r.getUint8(3),r.getUint16(4,!0)),l=(r.getUint16(6,!0),r.getUint16(8,!0)),c=r.getUint16(10,!0),_=r.getUint8(12);n&=4095;var h=t.slice(this.headerv1_size(),n);this.__debug_rx&&(console.log(`frame_size:${n} cmdid:${o}:%2x fifo remain:${t.length}`),console.log(`[sender]:${l} => [receiver]:${c} attr:${_}`));h[h.length-1],h[h.length-2];return this.cmd_handlers.has(o)&&(this.cmd_handlers.get(o)(h),this.last_cmdid=o),n+e}return console.warn("error head:{}, crc:{}"+(this.__bs2str(s),this.__crc8_func(s))),console.warn("buffer:{}"+this.__bs2str(t)),-3}catch(d){return console.warn("Exception:{}"+s),-4}},this.unpack_loopv0=function(t){var e=this.header_size(),i=t.slice(0,e),s=i[1]|i[2]<<8,r=i[4]|i[5]<<8,n=i[s-2]|i[s-1]<<8,a=this.__crc16_func(i);if(a==n){var o=t.slice(e,s-2);this.cmd_handlers.has(r)&&this.cmd_handlers.get(r)(o)}else console.warn("crc16 check failed",n,a)},this.unpack_loopv1=function(t){if(t.length>0){console.log("rx q len:",t.length);var e=this.dmv1_unpack_frame(t);e>0&&(this.rxdata=this.rxdata.slice(e))}},this.start_unpack_thread=function(){this.cmd_handlers=new Map([[this.CMDID_GET_VERSION_REQ,this.version_ack.bind(this)],[this.__CMDID_ENTER_UPGRADE_REQ,this.enter_upgrade_ack.bind(this)],[this.__CMDID_START_UPGRADE_REQ,this.start_upgrade_ack.bind(this)],[this.__CMDID_PACKAGE_UPGRADE_REQ,this.package_upgrade_ack.bind(this)],[this.__CMDID_END_UPGRADE_REQ,this.end_upgrade_ack.bind(this)]]),console.log(this.cmd_handlers),setInterval((()=>{this.unpack_loopv1(this.rxdata)}),10),console.warn("call once.")},this.start_unpack_thread()},L=i(8313);let N,Q,W=[],B=!1;const j=50,Z={0:"PWR_WAIT_RMS",1:"PWR_WAIT_DC_STABLE",2:"PWR_WAIT_PFC",3:"PWR_STABLE",4:"PWR_STABLE_SLEEP",5:"PWR_DISCHARGING",6:"PWR_FATAL"};var $={name:"App",components:{TodoItem:U,TodoForm:T,FileRead:m},data(){return{TodoItems:[{id:O()("todo-"),label:"fuck me",done:!1},{id:O()("todo-"),label:"fuck you",done:!1},{id:O()("todo-"),label:"have fun",done:!0},{id:O()("todo-"),label:"learn vue",done:!1}],binFile:new Uint8Array([]),logText:"",v1:null,upgradeProgress:0,variables:{vac:0,vac_rms:0,vdc:0,ibus:0,tempm0:0,tempm1:0,tempmos:0,fsm_raw:0,fsm_str:0},var_fifos:[new Array(j),new Array(j),new Array(j),new Array(j),new Array(j),new Array(j),new Array(j),new Array(j)],simu_dt:0,echartOption:{legend:{data:["vac","vac_rms","vdc","ibus","tempm0","tempm1","tempmos","fsm_raw","fsm_str"]}},chartInstance:null}},methods:{initChart(){this.chartInstance=L.S1(this.$refs.chart),this.variables["vac"]=123,this.variables["vdc"]=333;const t={xAxis:{type:"category"},yAxis:{type:"value"},series:[{data:Object.values(this.variables),type:"line"}]};this.chartInstance.setOption(t)},updatePlot(){const t={series:[{data:Object.values(this.variables)}]};this.chartInstance.setOption(t)},updatePlotFifo(){for(let t=0;t<this.var_fifos.length;t++)this.var_fifos[t].shift(),this.var_fifos[t].push(this.variables[Object.keys(this.variables)[t]]);console.log(this.var_fifos),this.echartOption={xAxis:{type:"category"},yAxis:{type:"value"},series:[{name:"vac",data:this.var_fifos[0]}]},this.chartInstance.setOption(this.echartOption)},fakeSimuPlot(){this.simu_dt+=.1;for(let t=0;t<this.var_fifos.length;t++)console.log(this.var_fifos[t]),this.var_fifos[t].shift(),this.var_fifos[t].push(Math.random());this.echartOption={xAxis:{type:"category"},yAxis:{type:"value"},series:[{name:"vac",data:this.var_fifos[0]},{name:"rms",data:this.var_fifos[1]}]},this.chartInstance.setOption(this.echartOption)},ble_read(){},ble_write(t){this.sendCommand(t)},addTodo(t){console.log("todo added"+t),this.TodoItems.push({id:O()("todo-"),label:t,done:!1}),console.log(this.v1.version()),console.log(this.v1.bs2str([48,49,50,51]))},handleNotifications(t){let e=new Uint8Array(t.target.value.buffer);this.v1.rxdata_input(e);let i=(new TextDecoder).decode(e);console.log(i),this.parseUploadString(i),this.logText+=i},send(){this.v1.version_reqv1()},v1ota(){this.v1.enter_upgrade_req()},append(){this.v1.rxdata_input((new TextEncoder).encode("abcd")),this.logText+=this.v1.ab2hex(this.v1.rxdata)},clear(){this.v1.rxdata_clear(),this.logText=""},sendCommand(t){return Q?B?(W.push(t),Promise.resolve()):(B=!0,Q.writeValue(t).then((()=>{B=!1;let t=W.shift();t&&this.sendCommand(t)}))):Promise.resolve()},testBLE(){console.log("btn"),navigator.bluetooth.requestDevice({filters:[{namePrefix:"@"}],optionalServices:["0000fff0-0000-1000-8000-00805f9b34fb","0000fff1-0000-1000-8000-00805f9b34fb"]}).then((t=>(console.log("Got device:",t.name),console.log("id:",t.id),t.gatt.connect()))).then((t=>(console.log("server:",t),N=t,N.getPrimaryService("0000fff0-0000-1000-8000-00805f9b34fb")))).then((t=>(console.log("> service:",t),t.getCharacteristic(65521)))).then((t=>{if(console.log("> characteristic:",t),t.properties.read&&console.log("> characteristic has read"),t.properties.write&&(console.log("> characteristic has write"),Q=t),t.properties.notify)return console.log("> characteristic has notify"),t.startNotifications().then((()=>{console.log("> Notifications started"),t.addEventListener("characteristicvaluechanged",this.handleNotifications)}));console.log("> characteristic has no notify")})).catch((t=>{console.log("Argh! "+t)}))},disconnect(){N&&(N.disconnect(),Q=null)},handleFileLoaded(t){console.log("file loaded to v1"),this.v1.upgrade_load_firmware(t),console.log(this.v1.package_upgrade_req(this.v1.UPPACK_SIZE,0,1))},up_show_progress(t){console.log(t),this.upgradeProgress=t,100==t&&console.log("upgrade done")},parseUploadString(t){if(!t.startsWith("/*")||!t.endsWith("*/"))return void console.log("invalid upload string");t=t.substring(2,t.length-2);let e=t.split(",");this.variables["vac"]=parseInt(e[0]),this.variables["vac_rms"]=parseInt(e[1]),this.variables["vdc"]=parseInt(e[2]),this.variables["ibus"]=parseInt(e[3]),this.variables["tempm0"]=parseInt(e[4]),this.variables["tempm1"]=parseInt(e[5]),this.variables["tempmos"]=parseInt(e[6]),this.variables["fsm_raw"]=parseInt(e[7]),this.variables["fsm_str"]=Z[this.variables["fsm_raw"]],console.log("vac:"+this.variables["vac"]),console.log("vac_rms:"+this.variables["vac_rms"]),console.log("vdc:"+this.variables["vdc"]),console.log("ibus_ma:"+this.variables["ibus"])}},mounted(){this.initChart()},created(){this.v1=new V(this.ble_read,this.ble_write,this.up_show_progress,4,1,!1,!0);for(let t=0;t<100;t++)this.binFile=new Uint8Array(20480);this.v1.upgrade_load_firmware(this.binFile)}};const H=(0,v.Z)($,[["render",p]]);var Y=H;(0,s.ri)(Y).mount("#app")}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}i.m=t,function(){var t=[];i.O=function(e,s,r,n){if(!s){var a=1/0;for(_=0;_<t.length;_++){s=t[_][0],r=t[_][1],n=t[_][2];for(var o=!0,l=0;l<s.length;l++)(!1&n||a>=n)&&Object.keys(i.O).every((function(t){return i.O[t](s[l])}))?s.splice(l--,1):(o=!1,n<a&&(a=n));if(o){t.splice(_--,1);var c=r();void 0!==c&&(e=c)}}return e}n=n||0;for(var _=t.length;_>0&&t[_-1][2]>n;_--)t[_]=t[_-1];t[_]=[s,r,n]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p="/fit/"}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var r,n,a=s[0],o=s[1],l=s[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)var _=l(i)}for(e&&e(s);c<a.length;c++)n=a[c],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(_)},s=self["webpackChunkvue0"]=self["webpackChunkvue0"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(9677)}));s=i.O(s)})();
//# sourceMappingURL=app.455646d8.js.map